        .review-meta {
            text-align: right;
            color: #666;
            font-size: 0.9rem;
            margin-top: 10px;
        }<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weird Foods Reviewer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(45deg, #ff6b6b, #ffa726);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }
        
        .tabs {
            display: flex;
            background: #f8f9fa;
        }
        
        .tab {
            flex: 1;
            padding: 15px;
            background: #e9ecef;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .tab.active {
            background: white;
            color: #ff6b6b;
            border-bottom: 3px solid #ff6b6b;
        }
        
        .tab:hover {
            background: #dee2e6;
        }
        
        .tab.active:hover {
            background: white;
        }
        
        .content {
            padding: 30px;
        }
        
        .admin-section {
            background: #fff3cd;
            border: 2px solid #ffeaa7;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .admin-section h3 {
            color: #856404;
            margin-bottom: 15px;
        }
        
        .admin-section p {
            color: #856404;
            margin-bottom: 15px;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-connected {
            background-color: #28a745;
        }
        
        .status-disconnected {
            background-color: #dc3545;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }
        
        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }
        
        .form-group input:focus {
            outline: none;
            border-color: #ff6b6b;
        }
        
        .rating-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .rating-item {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }
        
        .rating-item:hover {
            border-color: #ff6b6b;
            transform: translateY(-2px);
        }
        
        .rating-item h4 {
            margin-bottom: 10px;
            color: #333;
        }
        
        .rating-slider {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: #e9ecef;
            outline: none;
            -webkit-appearance: none;
            appearance: none;
            margin-bottom: 10px;
        }
        
        .rating-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #ff6b6b;
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }
        
        .rating-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #ff6b6b;
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }
        
        .rating-display {
            text-align: center;
            font-weight: 600;
            color: #ff6b6b;
            font-size: 1rem;
            line-height: 1.3;
            min-height: 60px;
        }
        
        .final-score {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin: 20px 0;
        }
        
        .final-score h3 {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .btn {
            background: linear-gradient(45deg, #ff6b6b, #ffa726);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s ease;
            width: 100%;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-small {
            padding: 8px 16px;
            font-size: 0.9rem;
            width: auto;
        }
        
        .review-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #ff6b6b;
        }
        
        .review-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .food-name {
            font-size: 1.3rem;
            font-weight: 600;
            color: #333;
        }
        
        .review-score {
            font-size: 1.5rem;
            font-weight: bold;
            color: #ff6b6b;
        }
        
        .review-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .detail-item {
            text-align: center;
            padding: 10px;
            background: white;
            border-radius: 6px;
        }
        
        .detail-label {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 5px;
        }
        
        .detail-score {
            font-weight: 600;
            color: #333;
        }
        
        .review-summary {
            font-style: italic;
            color: #555;
            border-top: 1px solid #dee2e6;
            padding-top: 15px;
        }
        
        .review-image {
            width: 100%;
            max-width: 300px;
            height: 200px;
            object-fit: cover;
            border-radius: 8px;
            margin: 15px 0;
            border: 2px solid #e9ecef;
        }
        
        .image-preview {
            text-align: center;
            margin: 10px 0;
        }
        
        .file-input {
            display: none;
        }
        
        .file-input-label {
            display: inline-block;
            padding: 10px 20px;
            background: #f8f9fa;
            border: 2px dashed #dee2e6;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .file-input-label:hover {
            border-color: #ff6b6b;
            background: #fff5f5;
        }
        
        .file-input-label.has-file {
            border-color: #28a745;
            background: #f8fff8;
        }
        
        .empty-state {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 40px;
        }
        
        .loading {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 20px;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .success {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .hidden {
            display: none;
        }
        
        code {
            background: #f8f9fa;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
        }
        
        .collapsible {
            cursor: pointer;
            user-select: none;
        }
        
        .collapsible:after {
            content: ' ▼';
            font-size: 0.8em;
            color: #666;
        }
        
        .collapsible.collapsed:after {
            content: ' ▶';
        }
        
        .collapsible-content {
            margin-top: 15px;
        }
        
        .collapsible-content.hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🍽️ Weird Foods Reviewer</h1>
            <p>Rate bizarre foods on a scale of 1-50 and share with the community!</p>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="showTab('review')">New Review</button>
            <button class="tab" onclick="showTab('history')">Community Reviews</button>
            <button class="tab" onclick="showTab('guide')">Scoring Guide</button>
            <button class="tab" onclick="showTab('debug')">Connection Debug</button>
        </div>
        
        <div id="review-tab" class="content">
            <form id="reviewForm">
                <div class="form-group">
                    <label for="reviewerName">Your Name (optional):</label>
                    <input type="text" id="reviewerName" placeholder="Anonymous" value="Anonymous">
                </div>
                
                <div class="form-group">
                    <label for="foodName">Food Name:</label>
                    <input type="text" id="foodName" required placeholder="Enter the weird food you're reviewing...">
                </div>
                
                <div class="form-group">
                    <label for="foodImage">Food Photo (optional):</label>
                    <input type="file" id="foodImage" accept="image/*" onchange="previewImage(this)">
                    <div id="imagePreview" style="margin-top: 10px; display: none;">
                        <img id="previewImg" style="max-width: 200px; max-height: 200px; border-radius: 8px; border: 2px solid #e9ecef;">
                        <button type="button" onclick="removeImage()" style="display: block; margin-top: 5px; padding: 5px 10px; background: #dc3545; color: white; border: none; border-radius: 4px; cursor: pointer;">Remove Image</button>
                    </div>
                    <small style="color: #666;">Max 10MB. JPG, PNG, GIF supported.</small>
                </div>
                
                <div class="rating-grid">
                    <div class="rating-item">
                        <h4>👅 Taste</h4>
                        <input type="range" id="taste" class="rating-slider" min="1" max="10" value="5">
                        <div class="rating-display" id="taste-display">5/10</div>
                    </div>
                    
                    <div class="rating-item">
                        <h4>🤚 Texture</h4>
                        <input type="range" id="texture" class="rating-slider" min="1" max="10" value="5">
                        <div class="rating-display" id="texture-display">5/10</div>
                    </div>
                    
                    <div class="rating-item">
                        <h4>👃 Aroma</h4>
                        <input type="range" id="aroma" class="rating-slider" min="1" max="10" value="5">
                        <div class="rating-display" id="aroma-display">5/10</div>
                    </div>
                    
                    <div class="rating-item">
                        <h4>👁️ Visual Appeal</h4>
                        <input type="range" id="visual" class="rating-slider" min="1" max="10" value="5">
                        <div class="rating-display" id="visual-display">5/10</div>
                    </div>
                    
                    <div class="rating-item">
                        <h4>✅ Would Recommend</h4>
                        <input type="range" id="recommend" class="rating-slider" min="1" max="10" value="5">
                        <div class="rating-display" id="recommend-display">5/10</div>
                    </div>
                </div>
                
                <div class="final-score">
                    <h3 id="finalScore">25/50</h3>
                    <p id="scoreCategory">Moderate weird food experience</p>
                </div>
                
                <div class="form-group">
                    <label for="summary">Review Summary (optional):</label>
                    <input type="text" id="summary" placeholder="Brief summary of your experience...">
                </div>
                
                <button type="submit" class="btn" id="submitBtn">Share Review with Community</button>
            </form>
        </div>
        
        <div id="history-tab" class="content hidden">
            <div id="reviewsList">
                <div class="loading">Loading community reviews...</div>
            </div>
            <button class="btn btn-small" onclick="loadReviews()" style="margin-top: 20px;">Refresh Reviews</button>
        </div>
        
        <div id="guide-tab" class="content hidden">
            <h2>Scoring Guide</h2>
            
            <h3>🎯 Overall Score: 1-50 Scale</h3>
            <p>Final rating combines all categories below</p>
            
            <h3>👅 Taste (1-10)</h3>
            <ul>
                <li><strong>10:</strong> Surprisingly delicious, would actively seek out again</li>
                <li><strong>8:</strong> Very good, pleasant surprise</li>
                <li><strong>6:</strong> Decent, wouldn't avoid it</li>
                <li><strong>4:</strong> Edible but underwhelming</li>
                <li><strong>2:</strong> Unpleasant, hard to finish</li>
                <li><strong>1:</strong> Inedible, had to spit out</li>
            </ul>
            
            <h3>🤚 Texture (1-10)</h3>
            <ul>
                <li><strong>10:</strong> Perfect/interesting texture that enhances the experience</li>
                <li><strong>8:</strong> Good mouthfeel, works well</li>
                <li><strong>6:</strong> Acceptable texture</li>
                <li><strong>4:</strong> Somewhat off-putting but manageable</li>
                <li><strong>2:</strong> Very strange/unpleasant texture</li>
                <li><strong>1:</strong> Revolting texture, ruins the food</li>
            </ul>
            
            <h3>👃 Aroma (1-10)</h3>
            <ul>
                <li><strong>10:</strong> Enticing smell that builds anticipation</li>
                <li><strong>8:</strong> Pleasant or neutral</li>
                <li><strong>6:</strong> Mild off-putting smell</li>
                <li><strong>4:</strong> Strong unpleasant odor but tolerable</li>
                <li><strong>2:</strong> Very bad smell, affects eating experience</li>
                <li><strong>1:</strong> Nauseating smell</li>
            </ul>
            
            <h3>👁️ Visual Appeal (1-10)</h3>
            <ul>
                <li><strong>10:</strong> Looks appetizing despite being unusual</li>
                <li><strong>8:</strong> Interesting/exotic looking in a good way</li>
                <li><strong>6:</strong> Strange but not off-putting</li>
                <li><strong>4:</strong> Somewhat unappealing visually</li>
                <li><strong>2:</strong> Looks quite unappetizing</li>
                <li><strong>1:</strong> Visually revolting</li>
            </ul>
            
            <h3>✅ Would Recommend Factor (1-10)</h3>
            <ul>
                <li><strong>10:</strong> Absolutely, everyone should try this</li>
                <li><strong>8:</strong> Yes, to adventurous eaters</li>
                <li><strong>6:</strong> Maybe, depends on the person</li>
                <li><strong>4:</strong> Only to very adventurous types</li>
                <li><strong>2:</strong> No, unless they really want the experience</li>
                <li><strong>1:</strong> Would actively warn people away</li>
            </ul>
        </div>
        
        <div id="debug-tab" class="content hidden">
            <h2>🔍 Connection Diagnostics</h2>
            
            <div class="admin-section">
                <h3>🔧 Airtable Connection Status</h3>
                <p id="connection-status-text">Checking connection...</p>
                <div id="connection-details" style="margin-top: 15px; font-family: monospace; background: #f8f9fa; padding: 15px; border-radius: 5px;">
                    <strong>API Key:</strong> patTgRT...fb<br>
                    <strong>Base ID:</strong> appI7BWKmJVfQ4dou<br>
                    <strong>Table:</strong> Reviews
                </div>
            </div>
            
            <button class="btn btn-small" onclick="runDiagnostics()" style="margin-bottom: 20px;">Run Full Diagnostics</button>
            
            <div id="diagnostic-results">
                <h3>Diagnostic Results:</h3>
                <pre id="diagnostic-output" style="background: #f8f9fa; padding: 15px; border-radius: 5px; font-family: monospace; white-space: pre-wrap; min-height: 200px; overflow-y: auto;">
Click "Run Full Diagnostics" to test the connection...
                </pre>
            </div>
            
            <div style="margin-top: 20px; padding: 15px; background: #fff3cd; border-radius: 5px;">
                <h4>🔧 Common Issues & Solutions:</h4>
                <ul style="line-height: 1.6;">
                    <li><strong>API Key Expired/Invalid:</strong> Create a new Personal Access Token in Airtable</li>
                    <li><strong>Wrong Base ID:</strong> Check the API documentation for your base</li>
                    <li><strong>Table Not Found:</strong> Make sure your table is named exactly "Reviews"</li>
                    <li><strong>Missing Permissions:</strong> API token needs read/write access to your base</li>
                    <li><strong>Missing Fields:</strong> Base needs all required columns (Food Name, Taste, etc.)</li>
                </ul>
            </div>
            
            <div style="margin-top: 20px; padding: 15px; background: #e7f3ff; border-radius: 5px;">
                <h4>📋 Required Airtable Setup:</h4>
                <p><strong>Your base must have a table called "Reviews" with these exact columns:</strong></p>
                <ul style="columns: 2; line-height: 1.6;">
                    <li>Food Name (Single line text)</li>
                    <li>Reviewer Name (Single line text)</li>
                    <li>Taste (Number)</li>
                    <li>Texture (Number)</li>
                    <li>Aroma (Number)</li>
                    <li>Visual (Number)</li>
                    <li>Recommend (Number)</li>
                    <li>Total Score (Number)</li>
                    <li>Summary (Long text)</li>
                    <li>Image (Attachment)</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        // 🔧 Airtable credentials - configured for your base
        const AIRTABLE_API_KEY = 'patTgRTxxUQJJejXd.545020312ff53cd826397c87d78e7f025999ca7c55f19944b6814b8cb2cc48fb';
        const AIRTABLE_BASE_ID = 'appI7BWKmJVfQ4dou';
        const AIRTABLE_TABLE_NAME = 'Reviews';
        
        let isConnected = false;
        
        // Initialize the app
        window.addEventListener('load', function() {
            console.log('🚀 Initializing Weird Foods Reviewer...');
            
            // Test connection immediately
            testAirtableConnection().then(success => {
                isConnected = success;
                updateConnectionStatus();
                
                if (success) {
                    console.log('✅ Connected to Airtable successfully');
                } else {
                    console.log('❌ Failed to connect to Airtable - check debug tab for details');
                }
            });
            
            initializeSliders();
        });
        
        function updateConnectionStatus() {
            const statusText = document.getElementById('connection-status-text');
            if (statusText) {
                if (isConnected) {
                    statusText.innerHTML = '<span style="color: green;">✅ Connected to Airtable</span>';
                } else {
                    statusText.innerHTML = '<span style="color: red;">❌ Connection failed - run diagnostics below</span>';
                }
            }
        }
        
        async function testAirtableConnection() {
            try {
                const response = await fetch(`https://api.airtable.com/v0/${AIRTABLE_BASE_ID}/${AIRTABLE_TABLE_NAME}?maxRecords=1`, {
                    headers: {
                        'Authorization': `Bearer ${AIRTABLE_API_KEY}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                return response.ok;
            } catch (error) {
                console.error('Airtable connection test failed:', error);
                return false;
            }
        }
        
        async function runDiagnostics() {
            const output = document.getElementById('diagnostic-output');
            output.textContent = 'Running diagnostics...\n';
            
            try {
                // Test 1: Basic connection
                output.textContent += '1. Testing basic connection to Airtable API...\n';
                
                const response = await fetch(`https://api.airtable.com/v0/${AIRTABLE_BASE_ID}/${AIRTABLE_TABLE_NAME}?maxRecords=1`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${AIRTABLE_API_KEY}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                output.textContent += `   Status: ${response.status} ${response.statusText}\n`;
                
                if (response.ok) {
                    output.textContent += '   ✅ Connection successful!\n';
                    
                    const data = await response.json();
                    output.textContent += `   Records found: ${data.records.length}\n`;
                    
                    if (data.records.length > 0) {
                        const fields = Object.keys(data.records[0].fields);
                        output.textContent += `   Available fields: ${fields.join(', ')}\n`;
                        
                        // Check for required fields
                        const required = ['Food Name', 'Reviewer Name', 'Taste', 'Texture', 'Aroma', 'Visual', 'Recommend', 'Total Score', 'Summary'];
                        const missing = required.filter(field => !fields.includes(field));
                        
                        if (missing.length === 0) {
                            output.textContent += '   ✅ All required fields present\n';
                        } else {
                            output.textContent += `   ⚠️  Missing fields: ${missing.join(', ')}\n`;
                        }
                    }
                    
                    // Test 2: Write permission
                    output.textContent += '\n2. Testing write permissions...\n';
                    
                    const testRecord = {
                        'Food Name': 'CONNECTION_TEST',
                        'Reviewer Name': 'System',
                        'Taste': 5,
                        'Texture': 5,
                        'Aroma': 5,
                        'Visual': 5,
                        'Recommend': 5,
                        'Total Score': 25,
                        'Summary': 'Test record for connection verification'
                    };
                    
                    const writeResponse = await fetch(`https://api.airtable.com/v0/${AIRTABLE_BASE_ID}/${AIRTABLE_TABLE_NAME}`, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${AIRTABLE_API_KEY}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            records: [{ fields: testRecord }]
                        })
                    });
                    
                    if (writeResponse.ok) {
                        output.textContent += '   ✅ Write permission successful\n';
                        
                        const writeData = await writeResponse.json();
                        const recordId = writeData.records[0].id;
                        
                        // Clean up test record
                        await fetch(`https://api.airtable.com/v0/${AIRTABLE_BASE_ID}/${AIRTABLE_TABLE_NAME}/${recordId}`, {
                            method: 'DELETE',
                            headers: {
                                'Authorization': `Bearer ${AIRTABLE_API_KEY}`
                            }
                        });
                        
                        output.textContent += '   ✅ Test record cleaned up\n';
                        output.textContent += '\n🎉 ALL TESTS PASSED! Your app should work perfectly.\n';
                        
                        // Update connection status
                        isConnected = true;
                        updateConnectionStatus();
                        
                    } else {
                        const writeError = await writeResponse.json();
                        output.textContent += `   ❌ Write permission failed: ${writeError.error?.message}\n`;
                        output.textContent += '   💡 Check your API token permissions\n';
                    }
                    
                } else {
                    const errorData = await response.json();
                    output.textContent += `   ❌ Connection failed: ${errorData.error?.message}\n`;
                    
                    if (response.status === 401) {
                        output.textContent += '   💡 SOLUTION: API key is invalid or expired\n';
                        output.textContent += '      → Go to Airtable → Account → Developer Hub → Personal Access Tokens\n';
                        output.textContent += '      → Create a new token with read/write permissions\n';
                    } else if (response.status === 404) {
                        output.textContent += '   💡 SOLUTION: Base ID or table name is incorrect\n';
                        output.textContent += '      → Check your base ID in the API documentation\n';
                        output.textContent += '      → Make sure your table is named exactly "Reviews"\n';
                    } else if (response.status === 403) {
                        output.textContent += '   💡 SOLUTION: API token lacks permissions\n';
                        output.textContent += '      → Recreate your token with full base access\n';
                    }
                }
                
            } catch (error) {
                output.textContent += `\n💥 Network Error: ${error.message}\n`;
                output.textContent += '💡 This could be a browser CORS issue or network problem\n';
            }
        }
        
        function toggleSection(sectionId) {
            // No longer needed - setup section removed
        }
        
        function showError(elementId, message) {
            // Simplified error handling
            console.error(message);
        }
        
        function hideError(elementId) {
            // Simplified error handling
        }
        
        function showSuccess(elementId, message) {
            // Simplified success handling
            console.log(message);
        }
        
        // Initialize sliders and their displays
        const sliders = ['taste', 'texture', 'aroma', 'visual', 'recommend'];
        
        function initializeSliders() {
            sliders.forEach(slider => {
                const element = document.getElementById(slider);
                const display = document.getElementById(slider + '-display');
                
                element.addEventListener('input', function() {
                    const value = parseInt(this.value);
                    const description = getScoreDescription(slider, value);
                    display.innerHTML = `<strong>${value}/10</strong><br><small style="color: #666; font-size: 0.9rem;">${description}</small>`;
                    updateFinalScore();
                });
                
                // Initialize display
                const value = parseInt(element.value);
                const description = getScoreDescription(slider, value);
                display.innerHTML = `<strong>${value}/10</strong><br><small style="color: #666; font-size: 0.9rem;">${description}</small>`;
            });
            
            updateFinalScore();
        }
        
        function getScoreDescription(category, score) {
            const descriptions = {
                taste: {
                    10: "Surprisingly delicious, would actively seek out again",
                    9: "Surprisingly delicious, would actively seek out again",
                    8: "Very good, pleasant surprise",
                    7: "Very good, pleasant surprise",
                    6: "Decent, wouldn't avoid it",
                    5: "Decent, wouldn't avoid it",
                    4: "Edible but underwhelming",
                    3: "Edible but underwhelming",
                    2: "Unpleasant, hard to finish",
                    1: "Inedible, had to spit out"
                },
                texture: {
                    10: "Perfect/interesting texture that enhances the experience",
                    9: "Perfect/interesting texture that enhances the experience",
                    8: "Good mouthfeel, works well",
                    7: "Good mouthfeel, works well",
                    6: "Acceptable texture",
                    5: "Acceptable texture",
                    4: "Somewhat off-putting but manageable",
                    3: "Somewhat off-putting but manageable",
                    2: "Very strange/unpleasant texture",
                    1: "Revolting texture, ruins the food"
                },
                aroma: {
                    10: "Enticing smell that builds anticipation",
                    9: "Enticing smell that builds anticipation",
                    8: "Pleasant or neutral",
                    7: "Pleasant or neutral",
                    6: "Mild off-putting smell",
                    5: "Mild off-putting smell",
                    4: "Strong unpleasant odor but tolerable",
                    3: "Strong unpleasant odor but tolerable",
                    2: "Very bad smell, affects eating experience",
                    1: "Nauseating smell"
                },
                visual: {
                    10: "Looks appetizing despite being unusual",
                    9: "Looks appetizing despite being unusual",
                    8: "Interesting/exotic looking in a good way",
                    7: "Interesting/exotic looking in a good way",
                    6: "Strange but not off-putting",
                    5: "Strange but not off-putting",
                    4: "Somewhat unappealing visually",
                    3: "Somewhat unappealing visually",
                    2: "Looks quite unappetizing",
                    1: "Visually revolting"
                },
                recommend: {
                    10: "Absolutely, everyone should try this",
                    9: "Absolutely, everyone should try this",
                    8: "Yes, to adventurous eaters",
                    7: "Yes, to adventurous eaters",
                    6: "Maybe, depends on the person",
                    5: "Maybe, depends on the person",
                    4: "Only to very adventurous types",
                    3: "Only to very adventurous types",
                    2: "No, unless they really want the experience",
                    1: "Would actively warn people away"
                }
            };
            
            return descriptions[category][score] || "";
        }

        function updateFinalScore() {
            let total = 0;
            sliders.forEach(slider => {
                const value = parseInt(document.getElementById(slider).value);
                total += value;
            });
            
            document.getElementById('finalScore').textContent = total + '/50';
            
            // Update score category
            const category = document.getElementById('scoreCategory');
            if (total >= 40) {
                category.textContent = "Outstanding weird food experience!";
            } else if (total >= 30) {
                category.textContent = "Good weird food experience";
            } else if (total >= 20) {
                category.textContent = "Challenging but edible unusual food experience";
            } else if (total >= 10) {
                category.textContent = "Difficult weird food experience";
            } else {
                category.textContent = "Avoid at all costs!";
            }
        }
        
        // Image handling functions
        function previewImage(input) {
            if (input.files && input.files[0]) {
                const file = input.files[0];
                
                // Check file size (10MB limit)
                if (file.size > 10 * 1024 * 1024) {
                    alert('File is too large. Please choose an image under 10MB.');
                    input.value = '';
                    return;
                }
                
                // Check file type
                if (!file.type.startsWith('image/')) {
                    alert('Please select an image file (JPG, PNG, GIF, etc.).');
                    input.value = '';
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('previewImg').src = e.target.result;
                    document.getElementById('imagePreview').style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        }
        
        function removeImage() {
            document.getElementById('foodImage').value = '';
            document.getElementById('imagePreview').style.display = 'none';
        }
        
        // Convert image file to base64 for Airtable
        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
            });
        }
        
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.content').forEach(tab => {
                tab.classList.add('hidden');
            });
            
            // Remove active class from all tab buttons
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName + '-tab').classList.remove('hidden');
            
            // Add active class to clicked tab
            event.target.classList.add('active');
            
            // Load reviews if history tab is selected
            if (tabName === 'history') {
                loadReviews();
            }
        }
        
        document.getElementById('reviewForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (!isConnected) {
                alert('❌ Not connected to Airtable. Please check the Connection Debug tab for troubleshooting.');
                return;
            }
            
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Saving...';
            
            try {
                const review = {
                    'Food Name': document.getElementById('foodName').value,
                    'Reviewer Name': document.getElementById('reviewerName').value || 'Anonymous',
                    'Taste': parseInt(document.getElementById('taste').value),
                    'Texture': parseInt(document.getElementById('texture').value),
                    'Aroma': parseInt(document.getElementById('aroma').value),
                    'Visual': parseInt(document.getElementById('visual').value),
                    'Recommend': parseInt(document.getElementById('recommend').value),
                    'Summary': document.getElementById('summary').value
                };
                
                review['Total Score'] = review.Taste + review.Texture + review.Aroma + review.Visual + review.Recommend;
                
                // Handle image upload if present
                const imageFile = document.getElementById('foodImage').files[0];
                if (imageFile) {
                    // For Airtable, we need to upload the image as an attachment
                    // This requires a two-step process: first create the record, then add the attachment
                    const base64Data = await fileToBase64(imageFile);
                    
                    // Create attachment object for Airtable
                    review['Image'] = [{
                        url: base64Data,
                        filename: imageFile.name
                    }];
                }
                
                const response = await fetch(`https://api.airtable.com/v0/${AIRTABLE_BASE_ID}/${AIRTABLE_TABLE_NAME}`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${AIRTABLE_API_KEY}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        records: [{
                            fields: review
                        }]
                    })
                });
                
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error?.message || 'Failed to save review');
                }
                
                // Reset form
                this.reset();
                document.getElementById('reviewerName').value = 'Anonymous';
                removeImage(); // Clear image preview
                sliders.forEach(slider => {
                    document.getElementById(slider).value = 5;
                    const description = getScoreDescription(slider, 5);
                    document.getElementById(slider + '-display').innerHTML = `<strong>5/10</strong><br><small style="color: #666; font-size: 0.9rem;">${description}</small>`;
                });
                updateFinalScore();
                
                alert('Review saved successfully and shared with the community!');
                
            } catch (error) {
                console.error('Error saving review:', error);
                alert(`Failed to save review: ${error.message}`);
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Share Review with Community';
            }
        });
        
        async function loadReviews() {
            if (!isConnected) {
                document.getElementById('reviewsList').innerHTML = '<div class="error">❌ Not connected to Airtable. Please check the Connection Debug tab.</div>';
                return;
            }
            
            document.getElementById('reviewsList').innerHTML = '<div class="loading">Loading community reviews...</div>';
            
            try {
                const response = await fetch(`https://api.airtable.com/v0/${AIRTABLE_BASE_ID}/${AIRTABLE_TABLE_NAME}?sort[0][field]=Created Time&sort[0][direction]=desc&maxRecords=50`, {
                    headers: {
                        'Authorization': `Bearer ${AIRTABLE_API_KEY}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error?.message || 'Failed to load reviews');
                }
                
                const data = await response.json();
                const reviews = data.records;
                
                const container = document.getElementById('reviewsList');
                
                if (reviews.length === 0) {
                    container.innerHTML = '<div class="empty-state">No reviews yet! Be the first to review a weird food!</div>';
                    return;
                }
                
                container.innerHTML = reviews.map(record => {
                    const fields = record.fields;
                    const imageHtml = fields.Image && fields.Image.length > 0 
                        ? `<div class="image-preview"><img src="${fields.Image[0].url}" alt="${fields['Food Name']}" class="review-image"></div>`
                        : '';
                    
                    return `
                        <div class="review-card">
                            <div class="review-header">
                                <div class="food-name">${fields['Food Name'] || 'Unknown Food'}</div>
                                <div class="review-score">${fields['Total Score'] || 0}/50</div>
                            </div>
                            
                            ${imageHtml}
                            
                            <div class="review-details">
                                <div class="detail-item">
                                    <div class="detail-label">Taste</div>
                                    <div class="detail-score">${fields.Taste || 0}/10</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">Texture</div>
                                    <div class="detail-score">${fields.Texture || 0}/10</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">Aroma</div>
                                    <div class="detail-score">${fields.Aroma || 0}/10</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">Visual</div>
                                    <div class="detail-score">${fields.Visual || 0}/10</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">Recommend</div>
                                    <div class="detail-score">${fields.Recommend || 0}/10</div>
                                </div>
                            </div>
                            
                            ${fields.Summary ? `<div class="review-summary">"${fields.Summary}"</div>` : ''}
                            
                            <div class="review-meta">
                                Reviewed by <strong>${fields['Reviewer Name'] || 'Anonymous'}</strong> on ${fields['Created Time'] ? new Date(fields['Created Time']).toLocaleDateString() : 'Unknown date'}
                            </div>
                        </div>
                    `;
                }).join('');
                
            } catch (error) {
                console.error('Error loading reviews:', error);
                document.getElementById('reviewsList').innerHTML = `<div class="error">Failed to load reviews: ${error.message}</div>`;
            }
        }
    </script>
</body>
</html>