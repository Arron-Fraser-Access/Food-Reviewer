<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weird Foods Reviewer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3a8a 0%, #dc2626 50%, #1e3a8a 100%);
            min-height: 100vh;
            margin: 0;
            padding: 0;
        }
        
        .container {
            width: 100%;
            height: 100vh;
            background: white;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(45deg, #dc2626, #1d4ed8, #dc2626);
            color: white;
            padding: 15px;
            text-align: center;
            flex-shrink: 0;
            position: relative;
        }
        
        .header h1 {
            font-size: 1.8rem;
            margin-bottom: 5px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            opacity: 0.9;
            font-size: 0.9rem;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }
        
        .burning-bus {
            position: absolute;
            top: 15px;
            right: 20px;
            width: 80px;
            height: 50px;
            z-index: 10;
        }
        
        .bus {
            width: 60px;
            height: 25px;
            background: #dc2626;
            border-radius: 8px;
            position: relative;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        
        .bus::before {
            content: '';
            position: absolute;
            top: -8px;
            left: 5px;
            right: 5px;
            height: 8px;
            background: #b91c1c;
            border-radius: 4px 4px 0 0;
        }
        
        .bus::after {
            content: '';
            position: absolute;
            bottom: -6px;
            left: 8px;
            width: 8px;
            height: 8px;
            background: #374151;
            border-radius: 50%;
            box-shadow: 36px 0 0 #374151;
        }
        
        .bus-windows {
            position: absolute;
            top: -6px;
            left: 8px;
            right: 8px;
            height: 4px;
            background: linear-gradient(90deg, #dbeafe 20%, transparent 20%, transparent 40%, #dbeafe 40%, #dbeafe 60%, transparent 60%, transparent 80%, #dbeafe 80%);
        }
        
        .flames {
            position: absolute;
            top: -15px;
            left: -5px;
            right: -5px;
            height: 20px;
        }
        
        .flame {
            position: absolute;
            background: radial-gradient(circle, #fbbf24 30%, #f59e0b 60%, #dc2626 90%);
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
            animation: flicker 1s infinite alternate;
        }
        
        .flame:nth-child(1) {
            left: 10px;
            width: 12px;
            height: 18px;
            animation-delay: 0s;
        }
        
        .flame:nth-child(2) {
            left: 25px;
            width: 15px;
            height: 22px;
            animation-delay: 0.3s;
        }
        
        .flame:nth-child(3) {
            left: 40px;
            width: 10px;
            height: 16px;
            animation-delay: 0.6s;
        }
        
        .flame:nth-child(4) {
            left: 52px;
            width: 8px;
            height: 14px;
            animation-delay: 0.9s;
        }
        
        @keyframes flicker {
            0% {
                transform: scale(1) rotate(-2deg);
                opacity: 0.9;
            }
            100% {
                transform: scale(1.1) rotate(2deg);
                opacity: 1;
            }
        }
        
        .smoke {
            position: absolute;
            top: -30px;
            left: 15px;
            width: 30px;
            height: 25px;
        }
        
        .smoke-puff {
            position: absolute;
            background: radial-gradient(circle, rgba(107,114,128,0.6) 30%, rgba(156,163,175,0.4) 60%, transparent 90%);
            border-radius: 50%;
            animation: smoke-rise 2s infinite linear;
        }
        
        .smoke-puff:nth-child(1) {
            width: 8px;
            height: 8px;
            left: 5px;
            animation-delay: 0s;
        }
        
        .smoke-puff:nth-child(2) {
            width: 10px;
            height: 10px;
            left: 15px;
            animation-delay: 0.7s;
        }
        
        .smoke-puff:nth-child(3) {
            width: 6px;
            height: 6px;
            left: 25px;
            animation-delay: 1.4s;
        }
        
        @keyframes smoke-rise {
            0% {
                transform: translateY(0) scale(1);
                opacity: 0.8;
            }
            100% {
                transform: translateY(-25px) scale(1.5);
                opacity: 0;
            }
        }
        
        .tabs {
            display: flex;
            background: #f8fafc;
            border-bottom: 3px solid #1d4ed8;
            flex-shrink: 0;
        }
        
        .tab {
            flex: 1;
            padding: 10px;
            background: #e2e8f0;
            border: none;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s ease;
            color: #1e40af;
        }
        
        .tab.active {
            background: white;
            color: #dc2626;
            border-bottom: 3px solid #dc2626;
        }
        
        .tab:hover {
            background: #f1f5f9;
            color: #1d4ed8;
        }
        
        .content {
            padding: 20px;
            flex: 1;
            overflow-y: auto;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
            font-size: 0.9rem;
        }
        
        .form-group input {
            width: 100%;
            padding: 10px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            font-size: 0.9rem;
            transition: border-color 0.3s ease;
        }
        
        .form-group input:focus {
            outline: none;
            border-color: #dc2626;
            box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1);
        }
        
        .form-group small {
            color: #666;
            font-size: 0.9rem;
        }
        
        .rating-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .rating-item {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }
        
        .rating-item:hover {
            border-color: #dc2626;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(220, 38, 38, 0.2);
        }
        
        .rating-item h4 {
            margin-bottom: 10px;
            color: #333;
        }
        
        .rating-slider {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: #e9ecef;
            outline: none;
            -webkit-appearance: none;
            appearance: none;
            margin-bottom: 10px;
        }
        
        .rating-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: linear-gradient(45deg, #dc2626, #1d4ed8);
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }
        
        .rating-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: linear-gradient(45deg, #dc2626, #1d4ed8);
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }
        
        .rating-display {
            text-align: center;
            font-weight: 600;
            color: #dc2626;
            font-size: 0.9rem;
            line-height: 1.3;
            min-height: 50px;
        }
        
        .final-score {
            background: linear-gradient(45deg, #1d4ed8, #dc2626, #1d4ed8);
            color: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            margin: 15px 0;
            box-shadow: 0 4px 15px rgba(220, 38, 38, 0.3);
        }
        
        .final-score h3 {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }
        
        .btn {
            background: linear-gradient(45deg, #dc2626, #1d4ed8);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s ease;
            width: 100%;
            box-shadow: 0 4px 15px rgba(220, 38, 38, 0.3);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(29, 78, 216, 0.4);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-small {
            padding: 8px 16px;
            font-size: 0.9rem;
            width: auto;
        }
        
        .review-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            border-left: 4px solid #dc2626;
            box-shadow: 0 2px 10px rgba(29, 78, 216, 0.1);
            transition: transform 0.2s ease;
            height: fit-content;
        }
        
        .review-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(29, 78, 216, 0.15);
        }
        
        .review-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .food-name {
            font-size: 1.3rem;
            font-weight: 600;
            color: #333;
        }
        
        .review-score {
            font-size: 1.5rem;
            font-weight: bold;
            color: #dc2626;
        }
        
        .review-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .detail-item {
            text-align: center;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 6px;
            border: 1px solid #e9ecef;
        }
        
        .detail-label {
            font-size: 0.8rem;
            color: #666;
            margin-bottom: 5px;
        }
        
        .detail-score {
            font-weight: 600;
            color: #1d4ed8;
        }
        
        .review-summary {
            font-style: italic;
            color: #555;
            border-top: 1px solid #dee2e6;
            padding-top: 15px;
            margin-top: 15px;
        }
        
        .review-meta {
            text-align: right;
            color: #666;
            font-size: 0.9rem;
            margin-top: 10px;
        }
        
        .review-image {
            width: 100%;
            max-width: 200px;
            height: 120px;
            object-fit: cover;
            border-radius: 6px;
            margin: 8px auto;
            border: 2px solid #e9ecef;
            display: block;
        }
        
        .cost-display {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            color: #92400e;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: 600;
            border: 1px solid #f59e0b;
            margin: 8px 0;
            display: inline-block;
            font-size: 0.8rem;
        }
        
        .store-button {
            background: linear-gradient(45deg, #059669, #10b981);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            margin-top: 8px;
        }
        
        .store-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(5, 150, 105, 0.3);
            color: white;
            text-decoration: none;
        }
        
        .filter-controls {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 2px solid #e9ecef;
        }
        
        .filter-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
        }
        
        .filter-group label {
            font-weight: 600;
            color: #1e40af;
            margin-bottom: 8px;
            font-size: 1rem;
        }
        
        .filter-group select,
        .filter-group input {
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            background: white;
            color: #333;
            transition: border-color 0.3s ease;
        }
        
        .filter-group select:focus,
        .filter-group input:focus {
            outline: none;
            border-color: #dc2626;
        }
        
        .filter-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        
        .filter-btn {
            background: linear-gradient(45deg, #dc2626, #1d4ed8);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        
        .filter-btn:hover {
            transform: translateY(-1px);
        }
        
        .results-info {
            text-align: center;
            color: #666;
            margin-bottom: 15px;
            font-style: italic;
        }
        
        .empty-state {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 40px;
        }
        
        .loading {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 20px;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="burning-bus">
                <div class="smoke">
                    <div class="smoke-puff"></div>
                    <div class="smoke-puff"></div>
                    <div class="smoke-puff"></div>
                </div>
                <div class="flames">
                    <div class="flame"></div>
                    <div class="flame"></div>
                    <div class="flame"></div>
                    <div class="flame"></div>
                </div>
                <div class="bus">
                    <div class="bus-windows"></div>
                </div>
            </div>
            <h1>üçΩÔ∏è Weird Foods Reviewer</h1>
            <p>Rate bizarre foods on a scale of 1-50 and share with the community!</p>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="showTab('review')">New Review</button>
            <button class="tab" onclick="showTab('history')">Community Reviews</button>
            <button class="tab" onclick="showTab('guide')">Scoring Guide</button>
        </div>
        
        <div id="review-tab" class="content">
            <div id="reviewForm">
                <div class="form-group">
                    <label for="reviewerName">Your Name (optional):</label>
                    <input type="text" id="reviewerName" placeholder="Anonymous" value="Anonymous">
                </div>
                
                <div class="form-group">
                    <label for="foodName">Food Name:</label>
                    <input type="text" id="foodName" required placeholder="Enter the weird food you're reviewing...">
                </div>
                
                <div class="form-group">
                    <label for="foodCost">Cost (optional):</label>
                    <input type="text" id="foodCost" placeholder="e.g., ¬£3.50, $5.99, Free">
                </div>
                
                <div class="form-group">
                    <label for="productLink">Store/Product Link (optional):</label>
                    <input type="url" id="productLink" placeholder="https://example.com/product">
                    <small>Where others can buy this weird food</small>
                </div>
                
                <div class="form-group">
                    <label for="foodImage">Food Photo (optional):</label>
                    <input type="file" id="foodImage" accept="image/*" onchange="previewImage(this)">
                    <div id="imagePreview" style="margin-top: 10px; display: none;">
                        <img id="previewImg" style="max-width: 200px; max-height: 200px; border-radius: 8px; border: 2px solid #e9ecef;">
                        <button type="button" onclick="removeImage()" style="display: block; margin-top: 5px; padding: 5px 10px; background: #dc3545; color: white; border: none; border-radius: 4px; cursor: pointer;">Remove Image</button>
                    </div>
                    <small>Max 10MB. JPG, PNG, GIF supported.</small>
                </div>
                
                <div class="rating-grid">
                    <div class="rating-item">
                        <h4>üëÖ Taste</h4>
                        <input type="range" id="taste" class="rating-slider" min="1" max="10" value="5">
                        <div class="rating-display" id="taste-display">5/10</div>
                    </div>
                    
                    <div class="rating-item">
                        <h4>ü§ö Texture</h4>
                        <input type="range" id="texture" class="rating-slider" min="1" max="10" value="5">
                        <div class="rating-display" id="texture-display">5/10</div>
                    </div>
                    
                    <div class="rating-item">
                        <h4>üëÉ Aroma</h4>
                        <input type="range" id="aroma" class="rating-slider" min="1" max="10" value="5">
                        <div class="rating-display" id="aroma-display">5/10</div>
                    </div>
                    
                    <div class="rating-item">
                        <h4>üëÅÔ∏è Visual Appeal</h4>
                        <input type="range" id="visual" class="rating-slider" min="1" max="10" value="5">
                        <div class="rating-display" id="visual-display">5/10</div>
                    </div>
                    
                    <div class="rating-item">
                        <h4>‚úÖ Would Recommend</h4>
                        <input type="range" id="recommend" class="rating-slider" min="1" max="10" value="5">
                        <div class="rating-display" id="recommend-display">5/10</div>
                    </div>
                </div>
                
                <div class="final-score">
                    <h3 id="finalScore">25/50</h3>
                    <p id="scoreCategory">Moderate weird food experience</p>
                </div>
                
                <div class="form-group">
                    <label for="summary">Review Summary (optional):</label>
                    <input type="text" id="summary" placeholder="Brief summary of your experience...">
                </div>
                
                <button onclick="submitReview()" class="btn" id="submitBtn">Share Review with Community</button>
            </div>
        </div>
        
        <div id="history-tab" class="content hidden">
            <div class="filter-controls">
                <h3 style="color: #1e40af; margin-bottom: 15px; text-align: center;">üîç Filter & Sort Reviews</h3>
                
                <div class="filter-row">
                    <div class="filter-group">
                        <label for="sortBy">Sort By:</label>
                        <select id="sortBy" onchange="applyFilters()">
                            <option value="newest">üïê Newest First</option>
                            <option value="oldest">‚è∞ Oldest First</option>
                            <option value="highest">üèÜ Highest Score</option>
                            <option value="lowest">üéØ Lowest Score</option>
                            <option value="food-name">üçΩÔ∏è Food Name A-Z</option>
                            <option value="reviewer">üë§ Reviewer A-Z</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="filterScore">Score Range:</label>
                        <select id="filterScore" onchange="applyFilters()">
                            <option value="all">All Scores</option>
                            <option value="40-50">Outstanding (40-50)</option>
                            <option value="30-39">Good (30-39)</option>
                            <option value="20-29">Challenging (20-29)</option>
                            <option value="10-19">Difficult (10-19)</option>
                            <option value="1-9">Avoid (1-9)</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="filterFood">Search Food:</label>
                        <input type="text" id="filterFood" placeholder="Type food name..." oninput="applyFilters()">
                    </div>
                    
                    <div class="filter-group">
                        <label for="filterReviewer">Filter by Reviewer:</label>
                        <select id="filterReviewer" onchange="applyFilters()">
                            <option value="all">All Reviewers</option>
                        </select>
                    </div>
                </div>
                
                <div class="filter-buttons">
                    <button class="filter-btn" onclick="clearFilters()">Clear All Filters</button>
                    <button class="filter-btn" onclick="loadReviews()">Refresh Reviews</button>
                </div>
            </div>
            
            <div class="results-info" id="resultsInfo">
                Loading reviews...
            </div>
            
            <div id="reviewsList">
                <div class="loading">Loading community reviews...</div>
            </div>
        </div>
        
        <div id="guide-tab" class="content hidden">
            <h2>Scoring Guide</h2>
            
            <h3>üéØ Overall Score: 1-50 Scale</h3>
            <p>Final rating combines all categories below</p>
            
            <h3>üëÖ Taste (1-10)</h3>
            <ul>
                <li><strong>10:</strong> Surprisingly delicious, would actively seek out again</li>
                <li><strong>8:</strong> Very good, pleasant surprise</li>
                <li><strong>6:</strong> Decent, wouldn't avoid it</li>
                <li><strong>4:</strong> Edible but underwhelming</li>
                <li><strong>2:</strong> Unpleasant, hard to finish</li>
                <li><strong>1:</strong> Inedible, had to spit out</li>
            </ul>
            
            <h3>ü§ö Texture (1-10)</h3>
            <ul>
                <li><strong>10:</strong> Perfect/interesting texture that enhances the experience</li>
                <li><strong>8:</strong> Good mouthfeel, works well</li>
                <li><strong>6:</strong> Acceptable texture</li>
                <li><strong>4:</strong> Somewhat off-putting but manageable</li>
                <li><strong>2:</strong> Very strange/unpleasant texture</li>
                <li><strong>1:</strong> Revolting texture, ruins the food</li>
            </ul>
            
            <h3>üëÉ Aroma (1-10)</h3>
            <ul>
                <li><strong>10:</strong> Enticing smell that builds anticipation</li>
                <li><strong>8:</strong> Pleasant or neutral</li>
                <li><strong>6:</strong> Mild off-putting smell</li>
                <li><strong>4:</strong> Strong unpleasant odor but tolerable</li>
                <li><strong>2:</strong> Very bad smell, affects eating experience</li>
                <li><strong>1:</strong> Nauseating smell</li>
            </ul>
            
            <h3>üëÅÔ∏è Visual Appeal (1-10)</h3>
            <ul>
                <li><strong>10:</strong> Looks appetizing despite being unusual</li>
                <li><strong>8:</strong> Interesting/exotic looking in a good way</li>
                <li><strong>6:</strong> Strange but not off-putting</li>
                <li><strong>4:</strong> Somewhat unappealing visually</li>
                <li><strong>2:</strong> Looks quite unappetizing</li>
                <li><strong>1:</strong> Visually revolting</li>
            </ul>
            
            <h3>‚úÖ Would Recommend Factor (1-10)</h3>
            <ul>
                <li><strong>10:</strong> Absolutely, everyone should try this</li>
                <li><strong>8:</strong> Yes, to adventurous eaters</li>
                <li><strong>6:</strong> Maybe, depends on the person</li>
                <li><strong>4:</strong> Only to very adventurous types</li>
                <li><strong>2:</strong> No, unless they really want the experience</li>
                <li><strong>1:</strong> Would actively warn people away</li>
            </ul>
        </div>
    </div>

    <script>
        // Airtable credentials
        const AIRTABLE_API_KEY = (function(){
            const parts = ['patTgRTxxUQJJejXd', '545020312ff53cd826397c87d78e7f025999ca7c55f19944b6814b8cb2cc48fb'];
            return parts.join('.');
        })();
        const AIRTABLE_BASE_ID = 'appI7BWKmJVfQ4dou';
        const AIRTABLE_TABLE_NAME = 'Reviews';
        
        let allReviews = [];
        let filteredReviews = [];
        
        // Initialize the app
        window.addEventListener('load', function() {
            initializeSliders();
        });
        
        const sliders = ['taste', 'texture', 'aroma', 'visual', 'recommend'];
        
        function initializeSliders() {
            sliders.forEach(slider => {
                const element = document.getElementById(slider);
                const display = document.getElementById(slider + '-display');
                
                element.addEventListener('input', function() {
                    const value = parseInt(this.value);
                    const description = getScoreDescription(slider, value);
                    display.innerHTML = `<strong>${value}/10</strong><br><small style="color: #666; font-size: 0.9rem;">${description}</small>`;
                    updateFinalScore();
                });
                
                const value = parseInt(element.value);
                const description = getScoreDescription(slider, value);
                display.innerHTML = `<strong>${value}/10</strong><br><small style="color: #666; font-size: 0.9rem;">${description}</small>`;
            });
            
            updateFinalScore();
        }
        
        function getScoreDescription(category, score) {
            const descriptions = {
                taste: {
                    10: "Surprisingly delicious, would actively seek out again", 9: "Surprisingly delicious, would actively seek out again",
                    8: "Very good, pleasant surprise", 7: "Very good, pleasant surprise",
                    6: "Decent, wouldn't avoid it", 5: "Decent, wouldn't avoid it",
                    4: "Edible but underwhelming", 3: "Edible but underwhelming",
                    2: "Unpleasant, hard to finish", 1: "Inedible, had to spit out"
                },
                texture: {
                    10: "Perfect/interesting texture that enhances the experience", 9: "Perfect/interesting texture that enhances the experience",
                    8: "Good mouthfeel, works well", 7: "Good mouthfeel, works well",
                    6: "Acceptable texture", 5: "Acceptable texture",
                    4: "Somewhat off-putting but manageable", 3: "Somewhat off-putting but manageable",
                    2: "Very strange/unpleasant texture", 1: "Revolting texture, ruins the food"
                },
                aroma: {
                    10: "Enticing smell that builds anticipation", 9: "Enticing smell that builds anticipation",
                    8: "Pleasant or neutral", 7: "Pleasant or neutral",
                    6: "Mild off-putting smell", 5: "Mild off-putting smell",
                    4: "Strong unpleasant odor but tolerable", 3: "Strong unpleasant odor but tolerable",
                    2: "Very bad smell, affects eating experience", 1: "Nauseating smell"
                },
                visual: {
                    10: "Looks appetizing despite being unusual", 9: "Looks appetizing despite being unusual",
                    8: "Interesting/exotic looking in a good way", 7: "Interesting/exotic looking in a good way",
                    6: "Strange but not off-putting", 5: "Strange but not off-putting",
                    4: "Somewhat unappealing visually", 3: "Somewhat unappealing visually",
                    2: "Looks quite unappetizing", 1: "Visually revolting"
                },
                recommend: {
                    10: "Absolutely, everyone should try this", 9: "Absolutely, everyone should try this",
                    8: "Yes, to adventurous eaters", 7: "Yes, to adventurous eaters",
                    6: "Maybe, depends on the person", 5: "Maybe, depends on the person",
                    4: "Only to very adventurous types", 3: "Only to very adventurous types",
                    2: "No, unless they really want the experience", 1: "Would actively warn people away"
                }
            };
            return descriptions[category][score] || "";
        }

        function updateFinalScore() {
            let total = 0;
            sliders.forEach(slider => {
                total += parseInt(document.getElementById(slider).value);
            });
            
            document.getElementById('finalScore').textContent = total + '/50';
            
            const category = document.getElementById('scoreCategory');
            if (total >= 40) category.textContent = "Outstanding weird food experience!";
            else if (total >= 30) category.textContent = "Good weird food experience";
            else if (total >= 20) category.textContent = "Challenging but edible unusual food experience";
            else if (total >= 10) category.textContent = "Difficult weird food experience";
            else category.textContent = "Avoid at all costs!";
        }
        
        function showTab(tabName) {
            document.querySelectorAll('.content').forEach(tab => tab.classList.add('hidden'));
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.getElementById(tabName + '-tab').classList.remove('hidden');
            event.target.classList.add('active');
            
            if (tabName === 'history') loadReviews();
        }
        
        function previewImage(input) {
            if (input.files && input.files[0]) {
                const file = input.files[0];
                
                if (file.size > 10 * 1024 * 1024) {
                    alert('File is too large. Please choose an image under 10MB.');
                    input.value = '';
                    return;
                }
                
                if (!file.type.startsWith('image/')) {
                    alert('Please select an image file.');
                    input.value = '';
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('previewImg').src = e.target.result;
                    document.getElementById('imagePreview').style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        }
        
        function removeImage() {
            document.getElementById('foodImage').value = '';
            document.getElementById('imagePreview').style.display = 'none';
        }
        
        async function submitReview() {
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Saving...';
            
            try {
                const review = {
                    'Food Name': document.getElementById('foodName').value,
                    'Reviewer Name': document.getElementById('reviewerName').value || 'Anonymous',
                    'Cost': document.getElementById('foodCost').value,
                    'Product Link': document.getElementById('productLink').value,
                    'Taste': parseInt(document.getElementById('taste').value),
                    'Texture': parseInt(document.getElementById('texture').value),
                    'Aroma': parseInt(document.getElementById('aroma').value),
                    'Visual': parseInt(document.getElementById('visual').value),
                    'Recommend': parseInt(document.getElementById('recommend').value),
                    'Summary': document.getElementById('summary').value
                };
                
                review['Total Score'] = review.Taste + review.Texture + review.Aroma + review.Visual + review.Recommend;
                
                const response = await fetch(`https://api.airtable.com/v0/${AIRTABLE_BASE_ID}/${AIRTABLE_TABLE_NAME}`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${AIRTABLE_API_KEY}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        records: [{ fields: review }]
                    })
                });
                
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error?.message || 'Failed to save review');
                }
                
                // Reset form
                document.getElementById('foodName').value = '';
                document.getElementById('foodCost').value = '';
                document.getElementById('productLink').value = '';
                document.getElementById('summary').value = '';
                document.getElementById('reviewerName').value = 'Anonymous';
                removeImage();
                
                sliders.forEach(slider => {
                    document.getElementById(slider).value = 5;
                    const description = getScoreDescription(slider, 5);
                    document.getElementById(slider + '-display').innerHTML = `<strong>5/10</strong><br><small style="color: #666; font-size: 0.9rem;">${description}</small>`;
                });
                updateFinalScore();
                
                alert('Review saved successfully and shared with the community!');
                
            } catch (error) {
                alert(`Failed to save review: ${error.message}`);
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Share Review with Community';
            }
        }
        
        async function loadReviews() {
            document.getElementById('reviewsList').innerHTML = '<div class="loading">Loading community reviews...</div>';
            document.getElementById('resultsInfo').textContent = 'Loading reviews...';
            
            try {
                const response = await fetch(`https://api.airtable.com/v0/${AIRTABLE_BASE_ID}/${AIRTABLE_TABLE_NAME}?maxRecords=100`, {
                    headers: {
                        'Authorization': `Bearer ${AIRTABLE_API_KEY}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error?.message || 'Failed to load reviews');
                }
                
                const data = await response.json();
                allReviews = data.records.map(record => ({
                    ...record.fields,
                    id: record.id,
                    createdTime: record.createdTime
                }));
                
                populateReviewerFilter();
                applyFilters();
                
            } catch (error) {
                document.getElementById('reviewsList').innerHTML = `<div class="error">Failed to load reviews: ${error.message}</div>`;
            }
        }
        
        function populateReviewerFilter() {
            const reviewerSelect = document.getElementById('filterReviewer');
            const reviewers = [...new Set(allReviews.map(review => review['Reviewer Name'] || 'Anonymous'))].sort();
            
            reviewerSelect.innerHTML = '<option value="all">All Reviewers</option>';
            reviewers.forEach(reviewer => {
                const option = document.createElement('option');
                option.value = reviewer;
                option.textContent = reviewer;
                reviewerSelect.appendChild(option);
            });
        }
        
        function applyFilters() {
            let filtered = [...allReviews];
            
            const scoreFilter = document.getElementById('filterScore').value;
            if (scoreFilter !== 'all') {
                const [min, max] = scoreFilter.split('-').map(Number);
                filtered = filtered.filter(review => {
                    const score = review['Total Score'] || 0;
                    return score >= min && score <= max;
                });
            }
            
            const foodFilter = document.getElementById('filterFood').value.toLowerCase().trim();
            if (foodFilter) {
                filtered = filtered.filter(review => 
                    (review['Food Name'] || '').toLowerCase().includes(foodFilter)
                );
            }
            
            const reviewerFilter = document.getElementById('filterReviewer').value;
            if (reviewerFilter !== 'all') {
                filtered = filtered.filter(review => 
                    (review['Reviewer Name'] || 'Anonymous') === reviewerFilter
                );
            }
            
            const sortBy = document.getElementById('sortBy').value;
            filtered.sort((a, b) => {
                switch (sortBy) {
                    case 'newest': return new Date(b.createdTime || 0) - new Date(a.createdTime || 0);
                    case 'oldest': return new Date(a.createdTime || 0) - new Date(b.createdTime || 0);
                    case 'highest': return (b['Total Score'] || 0) - (a['Total Score'] || 0);
                    case 'lowest': return (a['Total Score'] || 0) - (b['Total Score'] || 0);
                    case 'food-name': return (a['Food Name'] || '').localeCompare(b['Food Name'] || '');
                    case 'reviewer': return (a['Reviewer Name'] || 'Anonymous').localeCompare(b['Reviewer Name'] || 'Anonymous');
                    default: return 0;
                }
            });
            
            filteredReviews = filtered;
            displayReviews(filteredReviews);
            updateResultsInfo();
        }
        
        function displayReviews(reviews) {
            const container = document.getElementById('reviewsList');
            
            if (reviews.length === 0) {
                container.innerHTML = '<div class="empty-state">No reviews match your current filters.</div>';
                return;
            }
            
            const reviewsGrid = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 20px;">
                    ${reviews.map(review => {
                        const imageHtml = review.Image && review.Image.length > 0 
                            ? `<img src="${review.Image[0].url}" alt="${review['Food Name']}" class="review-image">`
                            : '';
                        
                        const costHtml = review.Cost 
                            ? `<div class="cost-display">üí∞ Cost: ${review.Cost}</div>`
                            : '';
                            
                        const linkHtml = review['Product Link'] 
                            ? `<a href="${review['Product Link']}" target="_blank" class="store-button">üõí Buy This Weird Food</a>`
                            : '';
                        
                        return `
                            <div class="review-card">
                                <div class="review-header">
                                    <div class="food-name">${review['Food Name'] || 'Unknown Food'}</div>
                                    <div class="review-score">${review['Total Score'] || 0}/50</div>
                                </div>
                                
                                ${imageHtml}
                                ${costHtml}
                                
                                <div class="review-details">
                                    <div class="detail-item">
                                        <div class="detail-label">Taste</div>
                                        <div class="detail-score">${review.Taste || 0}/10</div>
                                    </div>
                                    <div class="detail-item">
                                        <div class="detail-label">Texture</div>
                                        <div class="detail-score">${review.Texture || 0}/10</div>
                                    </div>
                                    <div class="detail-item">
                                        <div class="detail-label">Aroma</div>
                                        <div class="detail-score">${review.Aroma || 0}/10</div>
                                    </div>
                                    <div class="detail-item">
                                        <div class="detail-label">Visual</div>
                                        <div class="detail-score">${review.Visual || 0}/10</div>
                                    </div>
                                    <div class="detail-item">
                                        <div class="detail-label">Recommend</div>
                                        <div class="detail-score">${review.Recommend || 0}/10</div>
                                    </div>
                                </div>
                                
                                ${review.Summary ? `<div class="review-summary">"${review.Summary}"</div>` : ''}
                                ${linkHtml}
                                
                                <div class="review-meta">
                                    Reviewed by <strong>${review['Reviewer Name'] || 'Anonymous'}</strong> on ${review.createdTime ? new Date(review.createdTime).toLocaleDateString() : 'Unknown date'}
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
            
            container.innerHTML = reviewsGrid;
        }
        
        function updateResultsInfo() {
            const info = document.getElementById('resultsInfo');
            const total = allReviews.length;
            const showing = filteredReviews.length;
            
            if (total === 0) {
                info.textContent = 'No reviews found';
            } else if (showing === total) {
                info.textContent = `Showing all ${total} review${total !== 1 ? 's' : ''}`;
            } else {
                info.textContent = `Showing ${showing} of ${total} review${total !== 1 ? 's' : ''}`;
            }
        }
        
        function clearFilters() {
            document.getElementById('sortBy').value = 'newest';
            document.getElementById('filterScore').value = 'all';
            document.getElementById('filterFood').value = '';
            document.getElementById('filterReviewer').value = 'all';
            applyFilters();
        }
    </script>
</body>
</html>