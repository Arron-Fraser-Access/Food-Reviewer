<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weird Foods Reviewer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3a8a 0%, #dc2626 50%, #1e3a8a 100%);
            min-height: 100vh;
        }
        
        .container {
            width: 100%;
            min-height: 100vh;
            background: white;
        }
        
        .header {
            background: linear-gradient(45deg, #dc2626, #1d4ed8, #dc2626);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }
        
        .header h1 {
            font-size: 2rem;
            margin-bottom: 8px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1rem;
            opacity: 0.9;
        }
        
        .burning-bus {
            position: absolute;
            top: 15px;
            right: 20px;
            width: 70px;
            height: 45px;
        }
        
        .bus {
            width: 50px;
            height: 20px;
            background: #dc2626;
            border-radius: 6px;
            position: relative;
        }
        
        .bus::before {
            content: '';
            position: absolute;
            top: -6px;
            left: 4px;
            right: 4px;
            height: 6px;
            background: #b91c1c;
            border-radius: 3px 3px 0 0;
        }
        
        .bus::after {
            content: '';
            position: absolute;
            bottom: -4px;
            left: 6px;
            width: 6px;
            height: 6px;
            background: #374151;
            border-radius: 50%;
            box-shadow: 32px 0 0 #374151;
        }
        
        .flames {
            position: absolute;
            top: -12px;
            left: -4px;
            right: -4px;
            height: 15px;
        }
        
        .flame {
            position: absolute;
            background: radial-gradient(circle, #fbbf24 30%, #f59e0b 60%, #dc2626 90%);
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
            animation: flicker 1s infinite alternate;
        }
        
        .flame:nth-child(1) {
            left: 8px;
            width: 8px;
            height: 12px;
            animation-delay: 0s;
        }
        
        .flame:nth-child(2) {
            left: 20px;
            width: 10px;
            height: 15px;
            animation-delay: 0.3s;
        }
        
        .flame:nth-child(3) {
            left: 32px;
            width: 7px;
            height: 11px;
            animation-delay: 0.6s;
        }
        
        @keyframes flicker {
            0% { transform: scale(1) rotate(-1deg); opacity: 0.9; }
            100% { transform: scale(1.1) rotate(1deg); opacity: 1; }
        }
        
        .tabs {
            display: flex;
            background: #f8fafc;
            border-bottom: 3px solid #1d4ed8;
        }
        
        .tab {
            flex: 1;
            padding: 12px;
            background: #e2e8f0;
            border: none;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 600;
            color: #1e40af;
            transition: all 0.3s ease;
        }
        
        .tab.active {
            background: white;
            color: #dc2626;
            border-bottom: 3px solid #dc2626;
        }
        
        .tab:hover {
            background: #f1f5f9;
            color: #1d4ed8;
        }
        
        .content {
            padding: 25px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .form-group {
            margin-bottom: 18px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: #333;
            font-size: 0.9rem;
        }
        
        .form-group input, .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            font-size: 0.9rem;
            transition: border-color 0.3s ease;
        }
        
        .form-group input:focus, .form-group textarea:focus {
            outline: none;
            border-color: #dc2626;
            box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1);
        }
        
        .form-group small {
            color: #666;
            font-size: 0.8rem;
        }
        
        .rating-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .rating-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }
        
        .rating-item:hover {
            border-color: #dc2626;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(220, 38, 38, 0.2);
        }
        
        .rating-item h4 {
            margin-bottom: 8px;
            color: #333;
            font-size: 0.95rem;
        }
        
        .rating-slider {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #e9ecef;
            outline: none;
            -webkit-appearance: none;
            appearance: none;
            margin-bottom: 8px;
        }
        
        .rating-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: linear-gradient(45deg, #dc2626, #1d4ed8);
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }
        
        .rating-slider::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: linear-gradient(45deg, #dc2626, #1d4ed8);
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }
        
        .rating-display {
            text-align: center;
            font-weight: 600;
            color: #dc2626;
            font-size: 0.85rem;
            line-height: 1.3;
            min-height: 45px;
        }
        
        .final-score {
            background: linear-gradient(45deg, #1d4ed8, #dc2626, #1d4ed8);
            color: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(220, 38, 38, 0.3);
        }
        
        .final-score h3 {
            font-size: 1.4rem;
            margin-bottom: 5px;
        }
        
        .final-score p {
            font-size: 0.9rem;
        }
        
        .btn {
            background: linear-gradient(45deg, #dc2626, #1d4ed8);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s ease;
            width: 100%;
            box-shadow: 0 4px 15px rgba(220, 38, 38, 0.3);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(29, 78, 216, 0.4);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .filter-controls {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 2px solid #e9ecef;
        }
        
        .filter-controls h3 {
            color: #1e40af;
            margin-bottom: 12px;
            text-align: center;
            font-size: 1.1rem;
        }
        
        .filter-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 12px;
            margin-bottom: 15px;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
        }
        
        .filter-group label {
            font-weight: 600;
            color: #1e40af;
            margin-bottom: 5px;
            font-size: 0.85rem;
        }
        
        .filter-group select, .filter-group input {
            padding: 8px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            font-size: 0.85rem;
            background: white;
            transition: border-color 0.3s ease;
        }
        
        .filter-group select:focus, .filter-group input:focus {
            outline: none;
            border-color: #dc2626;
        }
        
        .filter-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        
        .filter-btn {
            background: linear-gradient(45deg, #dc2626, #1d4ed8);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        
        .filter-btn:hover {
            transform: translateY(-1px);
        }
        
        .results-info {
            text-align: center;
            color: #666;
            margin-bottom: 15px;
            font-style: italic;
            font-size: 0.9rem;
        }
        
        .review-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid #dc2626;
            box-shadow: 0 2px 8px rgba(29, 78, 216, 0.1);
            transition: transform 0.2s ease;
        }
        
        .review-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(29, 78, 216, 0.15);
        }
        
        .review-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .food-name {
            font-size: 1.1rem;
            font-weight: 600;
            color: #333;
        }
        
        .review-score {
            font-size: 1.2rem;
            font-weight: bold;
            color: #dc2626;
        }
        
        .review-image {
            width: 100%;
            max-width: 180px;
            height: 100px;
            object-fit: cover;
            border-radius: 6px;
            margin: 8px auto;
            border: 2px solid #e9ecef;
            display: block;
        }
        
        .cost-display {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            color: #92400e;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: 600;
            border: 1px solid #f59e0b;
            margin: 8px 0;
            display: inline-block;
            font-size: 0.8rem;
        }
        
        .store-button {
            background: linear-gradient(45deg, #059669, #10b981);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            margin: 8px 0;
        }
        
        .store-button:hover {
            transform: translateY(-1px);
            color: white;
            text-decoration: none;
        }
        
        .review-details {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            margin-bottom: 12px;
        }
        
        .detail-item {
            text-align: center;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 4px;
            border: 1px solid #e9ecef;
        }
        
        .detail-label {
            font-size: 0.7rem;
            color: #666;
            margin-bottom: 2px;
        }
        
        .detail-score {
            font-weight: 600;
            color: #1d4ed8;
            font-size: 0.85rem;
        }
        
        .review-summary {
            font-style: italic;
            color: #555;
            border-top: 1px solid #dee2e6;
            padding-top: 10px;
            margin-top: 10px;
            font-size: 0.9rem;
        }
        
        .vote-section {
            border-top: 1px solid #e9ecef;
            padding-top: 10px;
            margin-top: 10px;
        }
        
        .vote-buttons {
            display: flex;
            gap: 8px;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .vote-btn {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 4px 8px;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            background: white;
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .vote-btn:hover {
            transform: translateY(-1px);
        }
        
        .vote-btn.thumbs-up {
            color: #059669;
        }
        
        .vote-btn.thumbs-up:hover {
            background: #ecfdf5;
            border-color: #059669;
        }
        
        .vote-btn.thumbs-down {
            color: #dc2626;
        }
        
        .vote-btn.thumbs-down:hover {
            background: #fef2f2;
            border-color: #dc2626;
        }
        
        .vote-stats {
            font-size: 0.75rem;
            color: #666;
            margin-left: 8px;
        }
        
        .comment-toggle {
            background: none;
            border: none;
            color: #1d4ed8;
            cursor: pointer;
            font-size: 0.8rem;
            text-decoration: underline;
            padding: 0;
        }
        
        .comment-form {
            margin-top: 8px;
            display: none;
        }
        
        .comment-form.show {
            display: block;
        }
        
        .comment-input {
            width: 100%;
            padding: 8px;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            font-size: 0.8rem;
            min-height: 50px;
            resize: vertical;
        }
        
        .comment-submit {
            background: #1d4ed8;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            cursor: pointer;
            margin-top: 5px;
        }
        
        .existing-comments {
            margin-top: 8px;
            max-height: 100px;
            overflow-y: auto;
        }
        
        .comment-item {
            background: #f1f5f9;
            padding: 6px;
            border-radius: 4px;
            margin-bottom: 4px;
            font-size: 0.75rem;
            border-left: 2px solid #1d4ed8;
        }
        
        .comment-author {
            font-weight: 600;
            color: #1d4ed8;
            margin-bottom: 2px;
        }
        
        .comment-text {
            color: #475569;
        }
        
        .review-meta {
            text-align: right;
            color: #666;
            font-size: 0.8rem;
            margin-top: 8px;
        }
        
        .empty-state, .loading, .error {
            text-align: center;
            padding: 30px;
            font-style: italic;
            color: #666;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            border-radius: 6px;
        }
        
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="burning-bus">
                <div class="flames">
                    <div class="flame"></div>
                    <div class="flame"></div>
                    <div class="flame"></div>
                </div>
                <div class="bus"></div>
            </div>
            <h1>🍽️ Weird Foods Reviewer</h1>
            <p>Rate bizarre foods on a scale of 1-50 and share with the community!</p>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="showTab('review')">New Review</button>
            <button class="tab" onclick="showTab('history')">Community Reviews</button>
            <button class="tab" onclick="showTab('guide')">Scoring Guide</button>
        </div>
        
        <div id="review-tab" class="content">
            <div class="form-group">
                <label for="reviewerName">Your Name (optional):</label>
                <input type="text" id="reviewerName" placeholder="Anonymous" value="Anonymous">
            </div>
            
            <div class="form-group">
                <label for="foodName">Food Name:</label>
                <input type="text" id="foodName" required placeholder="Enter the weird food you're reviewing...">
            </div>
            
            <div class="form-group">
                <label for="foodCost">Cost (optional):</label>
                <input type="text" id="foodCost" placeholder="e.g., £3.50, $5.99, Free">
            </div>
            
            <div class="form-group">
                <label for="productLink">Store/Product Link (optional):</label>
                <input type="url" id="productLink" placeholder="https://example.com/product">
                <small>Where others can buy this weird food</small>
            </div>
            
            <div class="form-group">
                <label for="foodImage">Food Photo (optional):</label>
                <input type="file" id="foodImage" accept="image/*" onchange="previewImage(this)">
                <div id="imagePreview" style="margin-top: 8px; display: none;">
                    <img id="previewImg" style="max-width: 150px; max-height: 150px; border-radius: 6px; border: 2px solid #e9ecef;">
                    <button type="button" onclick="removeImage()" style="display: block; margin-top: 5px; padding: 4px 8px; background: #dc3545; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.8rem;">Remove</button>
                </div>
                <small>Max 10MB. JPG, PNG, GIF supported.</small>
            </div>
            
            <div class="rating-grid">
                <div class="rating-item">
                    <h4>👅 Taste</h4>
                    <input type="range" id="taste" class="rating-slider" min="1" max="10" value="5">
                    <div class="rating-display" id="taste-display">5/10</div>
                </div>
                
                <div class="rating-item">
                    <h4>🤚 Texture</h4>
                    <input type="range" id="texture" class="rating-slider" min="1" max="10" value="5">
                    <div class="rating-display" id="texture-display">5/10</div>
                </div>
                
                <div class="rating-item">
                    <h4>👃 Aroma</h4>
                    <input type="range" id="aroma" class="rating-slider" min="1" max="10" value="5">
                    <div class="rating-display" id="aroma-display">5/10</div>
                </div>
                
                <div class="rating-item">
                    <h4>👁️ Visual Appeal</h4>
                    <input type="range" id="visual" class="rating-slider" min="1" max="10" value="5">
                    <div class="rating-display" id="visual-display">5/10</div>
                </div>
                
                <div class="rating-item">
                    <h4>✅ Would Recommend</h4>
                    <input type="range" id="recommend" class="rating-slider" min="1" max="10" value="5">
                    <div class="rating-display" id="recommend-display">5/10</div>
                </div>
            </div>
            
            <div class="final-score">
                <h3 id="finalScore">25/50</h3>
                <p id="scoreCategory">Moderate weird food experience</p>
            </div>
            
            <div class="form-group">
                <label for="summary">Review Summary (optional):</label>
                <input type="text" id="summary" placeholder="Brief summary of your experience...">
            </div>
            
            <button onclick="submitReview()" class="btn" id="submitBtn">Share Review with Community</button>
        </div>
        
        <div id="history-tab" class="content hidden">
            <div class="filter-controls">
                <h3>🔍 Filter & Sort Reviews</h3>
                
                <div class="filter-row">
                    <div class="filter-group">
                        <label for="sortBy">Sort By:</label>
                        <select id="sortBy" onchange="applyFilters()">
                            <option value="newest">🕐 Newest First</option>
                            <option value="oldest">⏰ Oldest First</option>
                            <option value="highest">🏆 Highest Score</option>
                            <option value="lowest">🎯 Lowest Score</option>
                            <option value="food-name">🍽️ Food A-Z</option>
                            <option value="reviewer">👤 Reviewer A-Z</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="filterScore">Score Range:</label>
                        <select id="filterScore" onchange="applyFilters()">
                            <option value="all">All Scores</option>
                            <option value="40-50">Outstanding (40-50)</option>
                            <option value="30-39">Good (30-39)</option>
                            <option value="20-29">Challenging (20-29)</option>
                            <option value="10-19">Difficult (10-19)</option>
                            <option value="1-9">Avoid (1-9)</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="filterFood">Search Food:</label>
                        <input type="text" id="filterFood" placeholder="Type food name..." oninput="applyFilters()">
                    </div>
                    
                    <div class="filter-group">
                        <label for="filterReviewer">Reviewer:</label>
                        <select id="filterReviewer" onchange="applyFilters()">
                            <option value="all">All Reviewers</option>
                        </select>
                    </div>
                </div>
                
                <div class="filter-buttons">
                    <button class="filter-btn" onclick="clearFilters()">Clear Filters</button>
                    <button class="filter-btn" onclick="loadReviews()">Refresh</button>
                </div>
            </div>
            
            <div class="results-info" id="resultsInfo">Loading reviews...</div>
            <div id="reviewsList"><div class="loading">Loading community reviews...</div></div>
        </div>
        
        <div id="guide-tab" class="content hidden">
            <h2 style="font-size: 1.4rem; margin-bottom: 15px;">Scoring Guide</h2>
            
            <h3 style="font-size: 1.1rem; margin: 15px 0 8px 0;">🎯 Overall Score: 1-50 Scale</h3>
            <p style="margin-bottom: 15px;">Final rating combines all categories below</p>
            
            <h3 style="font-size: 1rem; margin: 12px 0 6px 0;">👅 Taste (1-10)</h3>
            <ul style="margin-bottom: 12px; line-height: 1.4;">
                <li><strong>10:</strong> Surprisingly delicious, would actively seek out again</li>
                <li><strong>8:</strong> Very good, pleasant surprise</li>
                <li><strong>6:</strong> Decent, wouldn't avoid it</li>
                <li><strong>4:</strong> Edible but underwhelming</li>
                <li><strong>2:</strong> Unpleasant, hard to finish</li>
                <li><strong>1:</strong> Inedible, had to spit out</li>
            </ul>
            
            <h3 style="font-size: 1rem; margin: 12px 0 6px 0;">🤚 Texture (1-10)</h3>
            <ul style="margin-bottom: 12px; line-height: 1.4;">
                <li><strong>10:</strong> Perfect/interesting texture that enhances the experience</li>
                <li><strong>8:</strong> Good mouthfeel, works well</li>
                <li><strong>6:</strong> Acceptable texture</li>
                <li><strong>4:</strong> Somewhat off-putting but manageable</li>
                <li><strong>2:</strong> Very strange/unpleasant texture</li>
                <li><strong>1:</strong> Revolting texture, ruins the food</li>
            </ul>
            
            <h3 style="font-size: 1rem; margin: 12px 0 6px 0;">👃 Aroma (1-10)</h3>
            <ul style="margin-bottom: 12px; line-height: 1.4;">
                <li><strong>10:</strong> Enticing smell that builds anticipation</li>
                <li><strong>8:</strong> Pleasant or neutral</li>
                <li><strong>6:</strong> Mild off-putting smell</li>
                <li><strong>4:</strong> Strong unpleasant odor but tolerable</li>
                <li><strong>2:</strong> Very bad smell, affects eating experience</li>
                <li><strong>1:</strong> Nauseating smell</li>
            </ul>
            
            <h3 style="font-size: 1rem; margin: 12px 0 6px 0;">👁️ Visual Appeal (1-10)</h3>
            <ul style="margin-bottom: 12px; line-height: 1.4;">
                <li><strong>10:</strong> Looks appetizing despite being unusual</li>
                <li><strong>8:</strong> Interesting/exotic looking in a good way</li>
                <li><strong>6:</strong> Strange but not off-putting</li>
                <li><strong>4:</strong> Somewhat unappealing visually</li>
                <li><strong>2:</strong> Looks quite unappetizing</li>
                <li><strong>1:</strong> Visually revolting</li>
            </ul>
            
            <h3 style="font-size: 1rem; margin: 12px 0 6px 0;">✅ Would Recommend Factor (1-10)</h3>
            <ul style="margin-bottom: 12px; line-height: 1.4;">
                <li><strong>10:</strong> Absolutely, everyone should try this</li>
                <li><strong>8:</strong> Yes, to adventurous eaters</li>
                <li><strong>6:</strong> Maybe, depends on the person</li>
                <li><strong>4:</strong> Only to very adventurous types</li>
                <li><strong>2:</strong> No, unless they really want the experience</li>
                <li><strong>1:</strong> Would actively warn people away</li>
            </ul>
        </div>
    </div>

    <script>
        const AIRTABLE_API_KEY = (function(){
            const parts = ['patTgRTxxUQJJejXd', '545020312ff53cd826397c87d78e7f025999ca7c55f19944b6814b8cb2cc48fb'];
            return parts.join('.');
        })();
        const AIRTABLE_BASE_ID = 'appI7BWKmJVfQ4dou';
        const AIRTABLE_TABLE_NAME = 'Reviews';
        
        let allReviews = [];
        let filteredReviews = [];
        
        window.addEventListener('load', initializeSliders);
        
        const sliders = ['taste', 'texture', 'aroma', 'visual', 'recommend'];
        
        function initializeSliders() {
            sliders.forEach(slider => {
                const element = document.getElementById(slider);
                const display = document.getElementById(slider + '-display');
                
                element.addEventListener('input', function() {
                    const value = parseInt(this.value);
                    const description = getScoreDescription(slider, value);
                    display.innerHTML = `<strong>${value}/10</strong><br><small style="color: #666; font-size: 0.75rem;">${description}</small>`;
                    updateFinalScore();
                });
                
                const value = parseInt(element.value);
                const description = getScoreDescription(slider, value);
                display.innerHTML = `<strong>${value}/10</strong><br><small style="color: #666; font-size: 0.75rem;">${description}</small>`;
            });
            updateFinalScore();
        }
        
        function getScoreDescription(category, score) {
            const descriptions = {
                taste: { 10: "Surprisingly delicious", 9: "Surprisingly delicious", 8: "Very good", 7: "Very good", 6: "Decent", 5: "Decent", 4: "Underwhelming", 3: "Underwhelming", 2: "Unpleasant", 1: "Inedible" },
                texture: { 10: "Perfect texture", 9: "Perfect texture", 8: "Good mouthfeel", 7: "Good mouthfeel", 6: "Acceptable", 5: "Acceptable", 4: "Off-putting", 3: "Off-putting", 2: "Very strange", 1: "Revolting" },
                aroma: { 10: "Enticing smell", 9: "Enticing smell", 8: "Pleasant", 7: "Pleasant", 6: "Mild off-putting", 5: "Mild off-putting", 4: "Unpleasant odor", 3: "Unpleasant odor", 2: "Very bad smell", 1: "Nauseating" },
                visual: { 10: "Looks appetizing", 9: "Looks appetizing", 8: "Interesting looking", 7: "Interesting looking", 6: "Strange but okay", 5: "Strange but okay", 4: "Unappealing", 3: "Unappealing", 2: "Unappetizing", 1: "Visually revolting" },
                recommend: { 10: "Everyone should try", 9: "Everyone should try", 8: "Yes, to adventurous eaters", 7: "Yes, to adventurous eaters", 6: "Maybe", 5: "Maybe", 4: "Very adventurous only", 3: "Very adventurous only", 2: "No", 1: "Warn people away" }
            };
            return descriptions[category][score] || "";
        }

        function updateFinalScore() {
            let total = 0;
            sliders.forEach(slider => total += parseInt(document.getElementById(slider).value));
            document.getElementById('finalScore').textContent = total + '/50';
            
            const category = document.getElementById('scoreCategory');
            if (total >= 40) category.textContent = "Outstanding weird food experience!";
            else if (total >= 30) category.textContent = "Good weird food experience";
            else if (total >= 20) category.textContent = "Challenging but edible";
            else if (total >= 10) category.textContent = "Difficult experience";
            else category.textContent = "Avoid at all costs!";
        }
        
        function showTab(tabName) {
            document.querySelectorAll('.content').forEach(tab => tab.classList.add('hidden'));
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.getElementById(tabName + '-tab').classList.remove('hidden');
            event.target.classList.add('active');
            
            if (tabName === 'history') loadReviews();
        }
        
        function previewImage(input) {
            if (input.files && input.files[0]) {
                const file = input.files[0];
                if (file.size > 10 * 1024 * 1024) {
                    alert('File too large. Max 10MB.');
                    input.value = '';
                    return;
                }
                if (!file.type.startsWith('image/')) {
                    alert('Please select an image file.');
                    input.value = '';
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = e => {
                    document.getElementById('previewImg').src = e.target.result;
                    document.getElementById('imagePreview').style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        }
        
        function removeImage() {
            document.getElementById('foodImage').value = '';
            document.getElementById('imagePreview').style.display = 'none';
        }
        
        async function submitReview() {
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Saving...';
            
            try {
                const review = {
                    'Food Name': document.getElementById('foodName').value,
                    'Reviewer Name': document.getElementById('reviewerName').value || 'Anonymous',
                    'Cost': document.getElementById('foodCost').value,
                    'Product Link': document.getElementById('productLink').value,
                    'Taste': parseInt(document.getElementById('taste').value),
                    'Texture': parseInt(document.getElementById('texture').value),
                    'Aroma': parseInt(document.getElementById('aroma').value),
                    'Visual': parseInt(document.getElementById('visual').value),
                    'Recommend': parseInt(document.getElementById('recommend').value),
                    'Summary': document.getElementById('summary').value,
                    'Thumbs Up': 0,
                    'Thumbs Down': 0,
                    'Comments': ''
                };
                
                review['Total Score'] = review.Taste + review.Texture + review.Aroma + review.Visual + review.Recommend;
                
                const response = await fetch(`https://api.airtable.com/v0/${AIRTABLE_BASE_ID}/${AIRTABLE_TABLE_NAME}`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${AIRTABLE_API_KEY}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ records: [{ fields: review }] })
                });
                
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error?.message || 'Failed to save');
                }
                
                // Reset form
                ['foodName', 'foodCost', 'productLink', 'summary'].forEach(id => 
                    document.getElementById(id).value = ''
                );
                document.getElementById('reviewerName').value = 'Anonymous';
                removeImage();
                
                sliders.forEach(slider => {
                    document.getElementById(slider).value = 5;
                    const description = getScoreDescription(slider, 5);
                    document.getElementById(slider + '-display').innerHTML = `<strong>5/10</strong><br><small style="color: #666; font-size: 0.75rem;">${description}</small>`;
                });
                updateFinalScore();
                
                alert('Review saved successfully!');
                
            } catch (error) {
                alert(`Failed to save: ${error.message}`);
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Share Review with Community';
            }
        }
        
        async function loadReviews() {
            document.getElementById('reviewsList').innerHTML = '<div class="loading">Loading reviews...</div>';
            
            try {
                const response = await fetch(`https://api.airtable.com/v0/${AIRTABLE_BASE_ID}/${AIRTABLE_TABLE_NAME}?maxRecords=100`, {
                    headers: {
                        'Authorization': `Bearer ${AIRTABLE_API_KEY}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) throw new Error('Failed to load reviews');
                
                const data = await response.json();
                allReviews = data.records.map(record => ({
                    ...record.fields,
                    id: record.id,
                    createdTime: record.createdTime
                }));
                
                populateReviewerFilter();
                applyFilters();
                
            } catch (error) {
                document.getElementById('reviewsList').innerHTML = `<div class="error">Error: ${error.message}</div>`;
            }
        }
        
        function populateReviewerFilter() {
            const select = document.getElementById('filterReviewer');
            const reviewers = [...new Set(allReviews.map(r => r['Reviewer Name'] || 'Anonymous'))].sort();
            select.innerHTML = '<option value="all">All Reviewers</option>';
            reviewers.forEach(reviewer => {
                const option = document.createElement('option');
                option.value = reviewer;
                option.textContent = reviewer;
                select.appendChild(option);
            });
        }
        
        function applyFilters() {
            let filtered = [...allReviews];
            
            const scoreFilter = document.getElementById('filterScore').value;
            if (scoreFilter !== 'all') {
                const [min, max] = scoreFilter.split('-').map(Number);
                filtered = filtered.filter(r => (r['Total Score'] || 0) >= min && (r['Total Score'] || 0) <= max);
            }
            
            const foodFilter = document.getElementById('filterFood').value.toLowerCase().trim();
            if (foodFilter) {
                filtered = filtered.filter(r => (r['Food Name'] || '').toLowerCase().includes(foodFilter));
            }
            
            const reviewerFilter = document.getElementById('filterReviewer').value;
            if (reviewerFilter !== 'all') {
                filtered = filtered.filter(r => (r['Reviewer Name'] || 'Anonymous') === reviewerFilter);
            }
            
            const sortBy = document.getElementById('sortBy').value;
            filtered.sort((a, b) => {
                switch (sortBy) {
                    case 'newest': return new Date(b.createdTime || 0) - new Date(a.createdTime || 0);
                    case 'oldest': return new Date(a.createdTime || 0) - new Date(b.createdTime || 0);
                    case 'highest': return (b['Total Score'] || 0) - (a['Total Score'] || 0);
                    case 'lowest': return (a['Total Score'] || 0) - (b['Total Score'] || 0);
                    case 'food-name': return (a['Food Name'] || '').localeCompare(b['Food Name'] || '');
                    case 'reviewer': return (a['Reviewer Name'] || 'Anonymous').localeCompare(b['Reviewer Name'] || 'Anonymous');
                    default: return 0;
                }
            });
            
            filteredReviews = filtered;
            displayReviews(filtered);
            updateResultsInfo();
        }
        
        function displayReviews(reviews) {
            const container = document.getElementById('reviewsList');
            
            if (reviews.length === 0) {
                container.innerHTML = '<div class="empty-state">No reviews match your filters.</div>';
                return;
            }
            
            container.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(380px, 1fr)); gap: 15px;">
                    ${reviews.map(review => {
                        const imageHtml = review.Image && review.Image.length > 0 
                            ? `<img src="${review.Image[0].url}" alt="${review['Food Name']}" class="review-image">`
                            : '';
                        
                        const costHtml = review.Cost 
                            ? `<div class="cost-display">💰 ${review.Cost}</div>`
                            : '';
                            
                        const linkHtml = review['Product Link'] 
                            ? `<a href="${review['Product Link']}" target="_blank" class="store-button">🛒 Buy This</a>`
                            : '';
                            
                        const commentsArray = review.Comments ? review.Comments.split('|||').filter(c => c.trim()) : [];
                        const commentsHtml = commentsArray.length > 0 
                            ? `<div class="existing-comments">
                                ${commentsArray.map(comment => {
                                    const [author, text] = comment.split(':::', 2);
                                    return `<div class="comment-item">
                                        <div class="comment-author">${author || 'Anonymous'}</div>
                                        <div class="comment-text">${text || comment}</div>
                                    </div>`;
                                }).join('')}
                               </div>`
                            : '';
                        
                        return `
                            <div class="review-card">
                                <div class="review-header">
                                    <div class="food-name">${review['Food Name'] || 'Unknown Food'}</div>
                                    <div class="review-score">${review['Total Score'] || 0}/50</div>
                                </div>
                                
                                ${imageHtml}
                                ${costHtml}
                                
                                <div class="review-details">
                                    <div class="detail-item">
                                        <div class="detail-label">Taste</div>
                                        <div class="detail-score">${review.Taste || 0}/10</div>
                                    </div>
                                    <div class="detail-item">
                                        <div class="detail-label">Texture</div>
                                        <div class="detail-score">${review.Texture || 0}/10</div>
                                    </div>
                                    <div class="detail-item">
                                        <div class="detail-label">Aroma</div>
                                        <div class="detail-score">${review.Aroma || 0}/10</div>
                                    </div>
                                    <div class="detail-item">
                                        <div class="detail-label">Visual</div>
                                        <div class="detail-score">${review.Visual || 0}/10</div>
                                    </div>
                                    <div class="detail-item">
                                        <div class="detail-label">Recommend</div>
                                        <div class="detail-score">${review.Recommend || 0}/10</div>
                                    </div>
                                </div>
                                
                                ${review.Summary ? `<div class="review-summary">"${review.Summary}"</div>` : ''}
                                ${linkHtml}
                                
                                <div class="vote-section">
                                    <div class="vote-buttons">
                                        <button class="vote-btn thumbs-up" onclick="vote('${review.id}', 'up')">
                                            👍 <span>${review['Thumbs Up'] || 0}</span>
                                        </button>
                                        <button class="vote-btn thumbs-down" onclick="vote('${review.id}', 'down')">
                                            👎 <span>${review['Thumbs Down'] || 0}</span>
                                        </button>
                                        <span class="vote-stats">${(review['Thumbs Up'] || 0) + (review['Thumbs Down'] || 0)} votes</span>
                                    </div>
                                    
                                    <div class="comment-section">
                                        <button class="comment-toggle" onclick="toggleComments('${review.id}')">💬 Add Comment</button>
                                        <div class="comment-form" id="comment-form-${review.id}">
                                            <textarea class="comment-input" id="comment-input-${review.id}" placeholder="Share your thoughts..."></textarea>
                                            <button class="comment-submit" onclick="submitComment('${review.id}')">Post</button>
                                        </div>
                                        ${commentsHtml}
                                    </div>
                                </div>
                                
                                <div class="review-meta">
                                    by <strong>${review['Reviewer Name'] || 'Anonymous'}</strong> on ${review.createdTime ? new Date(review.createdTime).toLocaleDateString() : 'Unknown'}
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
        }
        
        function updateResultsInfo() {
            const info = document.getElementById('resultsInfo');
            const total = allReviews.length;
            const showing = filteredReviews.length;
            
            if (total === 0) info.textContent = 'No reviews found';
            else if (showing === total) info.textContent = `Showing all ${total} review${total !== 1 ? 's' : ''}`;
            else info.textContent = `Showing ${showing} of ${total} review${total !== 1 ? 's' : ''}`;
        }
        
        function clearFilters() {
            document.getElementById('sortBy').value = 'newest';
            document.getElementById('filterScore').value = 'all';
            document.getElementById('filterFood').value = '';
            document.getElementById('filterReviewer').value = 'all';
            applyFilters();
        }
        
        async function vote(reviewId, voteType) {
            try {
                const review = allReviews.find(r => r.id === reviewId);
                if (!review) return;
                
                let thumbsUp = review['Thumbs Up'] || 0;
                let thumbsDown = review['Thumbs Down'] || 0;
                
                if (voteType === 'up') thumbsUp += 1;
                else thumbsDown += 1;
                
                const response = await fetch(`https://api.airtable.com/v0/${AIRTABLE_BASE_ID}/${AIRTABLE_TABLE_NAME}/${reviewId}`, {
                    method: 'PATCH',
                    headers: {
                        'Authorization': `Bearer ${AIRTABLE_API_KEY}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        fields: {
                            'Thumbs Up': thumbsUp,
                            'Thumbs Down': thumbsDown
                        }
                    })
                });
                
                if (response.ok) {
                    review['Thumbs Up'] = thumbsUp;
                    review['Thumbs Down'] = thumbsDown;
                    displayReviews(filteredReviews);
                } else {
                    throw new Error('Failed to save vote');
                }
                
            } catch (error) {
                alert('Failed to save vote');
            }
        }
        
        function toggleComments(reviewId) {
            const form = document.getElementById(`comment-form-${reviewId}`);
            form.classList.toggle('show');
            if (form.classList.contains('show')) {
                setTimeout(() => document.getElementById(`comment-input-${reviewId}`).focus(), 100);
            }
        }
        
        async function submitComment(reviewId) {
            const input = document.getElementById(`comment-input-${reviewId}`);
            const text = input.value.trim();
            
            if (!text) {
                alert('Please enter a comment');
                return;
            }
            
            try {
                const review = allReviews.find(r => r.id === reviewId);
                if (!review) return;
                
                const userName = document.getElementById('reviewerName')?.value || 'Anonymous';
                const newComment = `${userName}:::${text}`;
                const existing = review.Comments || '';
                const updated = existing ? `${existing}|||${newComment}` : newComment;
                
                const response = await fetch(`https://api.airtable.com/v0/${AIRTABLE_BASE_ID}/${AIRTABLE_TABLE_NAME}/${reviewId}`, {
                    method: 'PATCH',
                    headers: {
                        'Authorization': `Bearer ${AIRTABLE_API_KEY}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ fields: { 'Comments': updated } })
                });
                
                if (response.ok) {
                    review.Comments = updated;
                    displayReviews(filteredReviews);
                    input.value = '';
                    document.getElementById(`comment-form-${reviewId}`).classList.remove('show');
                } else {
                    throw new Error('Failed to save comment');
                }
                
            } catch (error) {
                alert('Failed to save comment');
            }
        }
    </script>
</body>
</html>