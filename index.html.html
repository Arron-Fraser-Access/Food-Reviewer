<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weird Foods Reviewer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(45deg, #ff6b6b, #ffa726);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }
        
        .tabs {
            display: flex;
            background: #f8f9fa;
        }
        
        .tab {
            flex: 1;
            padding: 15px;
            background: #e9ecef;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .tab.active {
            background: white;
            color: #ff6b6b;
            border-bottom: 3px solid #ff6b6b;
        }
        
        .tab:hover {
            background: #dee2e6;
        }
        
        .tab.active:hover {
            background: white;
        }
        
        .content {
            padding: 30px;
        }
        
        .setup-warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            color: #856404;
        }
        
        .setup-warning h3 {
            color: #856404;
            margin-bottom: 10px;
        }
        
        .config-section {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-connected {
            background-color: #28a745;
        }
        
        .status-disconnected {
            background-color: #dc3545;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }
        
        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }
        
        .form-group input:focus {
            outline: none;
            border-color: #ff6b6b;
        }
        
        .rating-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .rating-item {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }
        
        .rating-item:hover {
            border-color: #ff6b6b;
            transform: translateY(-2px);
        }
        
        .rating-item h4 {
            margin-bottom: 10px;
            color: #333;
        }
        
        .rating-slider {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: #e9ecef;
            outline: none;
            -webkit-appearance: none;
            appearance: none;
            margin-bottom: 10px;
        }
        
        .rating-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #ff6b6b;
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }
        
        .rating-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #ff6b6b;
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }
        
        .rating-display {
            text-align: center;
            font-weight: 600;
            color: #ff6b6b;
            font-size: 1rem;
            line-height: 1.3;
            min-height: 60px;
        }
        
        .final-score {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin: 20px 0;
        }
        
        .final-score h3 {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .btn {
            background: linear-gradient(45deg, #ff6b6b, #ffa726);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s ease;
            width: 100%;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-small {
            padding: 8px 16px;
            font-size: 0.9rem;
            width: auto;
        }
        
        .review-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #ff6b6b;
        }
        
        .review-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .food-name {
            font-size: 1.3rem;
            font-weight: 600;
            color: #333;
        }
        
        .review-score {
            font-size: 1.5rem;
            font-weight: bold;
            color: #ff6b6b;
        }
        
        .review-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .detail-item {
            text-align: center;
            padding: 10px;
            background: white;
            border-radius: 6px;
        }
        
        .detail-label {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 5px;
        }
        
        .detail-score {
            font-weight: 600;
            color: #333;
        }
        
        .review-summary {
            font-style: italic;
            color: #555;
            border-top: 1px solid #dee2e6;
            padding-top: 15px;
        }
        
        .review-meta {
            text-align: right;
            color: #666;
            font-size: 0.9rem;
            margin-top: 10px;
        }
        
        .empty-state {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 40px;
        }
        
        .loading {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 20px;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .success {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .hidden {
            display: none;
        }
        
        code {
            background: #f8f9fa;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üçΩÔ∏è Weird Foods Reviewer</h1>
            <p>Rate bizarre foods on a scale of 1-50 and share with the community!</p>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="showTab('setup')">Setup</button>
            <button class="tab" onclick="showTab('review')">New Review</button>
            <button class="tab" onclick="showTab('history')">Community Reviews</button>
            <button class="tab" onclick="showTab('guide')">Scoring Guide</button>
        </div>
        
        <div id="setup-tab" class="content">
            <div class="setup-warning">
                <h3>‚ö†Ô∏è Setup Required</h3>
                <p>To save and share reviews with the community, you need to connect to Supabase (a free database service).</p>
            </div>
            
            <div class="config-section">
                <h3>
                    <span id="connection-status" class="status-indicator status-disconnected"></span>
                    Supabase Connection
                </h3>
                <p><strong>Status:</strong> <span id="connection-text">Not connected</span></p>
            </div>
            
            <h3>üîß Setup Instructions:</h3>
            <ol style="line-height: 1.8; margin: 20px 0;">
                <li><strong>Create a free Supabase account</strong> at <a href="https://supabase.com" target="_blank">supabase.com</a></li>
                <li><strong>Create a new project</strong> (choose any name)</li>
                <li><strong>Go to Settings ‚Üí API</strong> in your project</li>
                <li><strong>Copy your Project URL and anon public key</strong></li>
                <li><strong>Enter them below:</strong></li>
            </ol>
            
            <div class="form-group">
                <label for="supabaseUrl">Supabase Project URL:</label>
                <input type="url" id="supabaseUrl" placeholder="https://your-project.supabase.co">
            </div>
            
            <div class="form-group">
                <label for="supabaseKey">Supabase Anon Key:</label>
                <input type="text" id="supabaseKey" placeholder="Your anon public key">
            </div>
            
            <button id="connectBtn" class="btn" onclick="connectSupabase()">Connect to Supabase</button>
            
            <div id="setup-error" class="error hidden"></div>
            <div id="setup-success" class="success hidden"></div>
            
            <h3 style="margin-top: 30px;">üìã Database Setup (One-time only):</h3>
            <p>After connecting, click this button to create the reviews table:</p>
            <button id="setupTableBtn" class="btn btn-small" onclick="setupTable()" disabled>Create Reviews Table</button>
            
            <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                <h4>SQL Command (if needed):</h4>
                <p>If the automatic setup fails, run this SQL in your Supabase SQL editor:</p>
                <code style="display: block; margin: 10px 0; padding: 15px; white-space: pre-wrap;">CREATE TABLE reviews (
  id BIGSERIAL PRIMARY KEY,
  food_name TEXT NOT NULL,
  taste INTEGER NOT NULL CHECK (taste >= 1 AND taste <= 10),
  texture INTEGER NOT NULL CHECK (texture >= 1 AND texture <= 10),
  aroma INTEGER NOT NULL CHECK (aroma >= 1 AND aroma <= 10),
  visual INTEGER NOT NULL CHECK (visual >= 1 AND visual <= 10),
  recommend INTEGER NOT NULL CHECK (recommend >= 1 AND recommend <= 10),
  total_score INTEGER NOT NULL,
  summary TEXT,
  reviewer_name TEXT DEFAULT 'Anonymous',
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Enable Row Level Security
ALTER TABLE reviews ENABLE ROW LEVEL SECURITY;

-- Allow all operations for everyone (public access)
CREATE POLICY "Allow all operations" ON reviews FOR ALL USING (true);</code>
            </div>
        </div>
        
        <div id="review-tab" class="content hidden">
            <div id="review-form-container">
                <form id="reviewForm">
                    <div class="form-group">
                        <label for="reviewerName">Your Name (optional):</label>
                        <input type="text" id="reviewerName" placeholder="Anonymous" value="Anonymous">
                    </div>
                    
                    <div class="form-group">
                        <label for="foodName">Food Name:</label>
                        <input type="text" id="foodName" required placeholder="Enter the weird food you're reviewing...">
                    </div>
                    
                    <div class="rating-grid">
                        <div class="rating-item">
                            <h4>üëÖ Taste</h4>
                            <input type="range" id="taste" class="rating-slider" min="1" max="10" value="5">
                            <div class="rating-display" id="taste-display">5/10</div>
                        </div>
                        
                        <div class="rating-item">
                            <h4>ü§ö Texture</h4>
                            <input type="range" id="texture" class="rating-slider" min="1" max="10" value="5">
                            <div class="rating-display" id="texture-display">5/10</div>
                        </div>
                        
                        <div class="rating-item">
                            <h4>üëÉ Aroma</h4>
                            <input type="range" id="aroma" class="rating-slider" min="1" max="10" value="5">
                            <div class="rating-display" id="aroma-display">5/10</div>
                        </div>
                        
                        <div class="rating-item">
                            <h4>üëÅÔ∏è Visual Appeal</h4>
                            <input type="range" id="visual" class="rating-slider" min="1" max="10" value="5">
                            <div class="rating-display" id="visual-display">5/10</div>
                        </div>
                        
                        <div class="rating-item">
                            <h4>‚úÖ Would Recommend</h4>
                            <input type="range" id="recommend" class="rating-slider" min="1" max="10" value="5">
                            <div class="rating-display" id="recommend-display">5/10</div>
                        </div>
                    </div>
                    
                    <div class="final-score">
                        <h3 id="finalScore">25/50</h3>
                        <p id="scoreCategory">Moderate weird food experience</p>
                    </div>
                    
                    <div class="form-group">
                        <label for="summary">Review Summary (optional):</label>
                        <input type="text" id="summary" placeholder="Brief summary of your experience...">
                    </div>
                    
                    <button type="submit" class="btn" id="submitBtn">Share Review with Community</button>
                </form>
            </div>
            
            <div id="review-not-connected" class="error hidden">
                Please connect to Supabase in the Setup tab first to save reviews.
            </div>
        </div>
        
        <div id="history-tab" class="content hidden">
            <div id="reviewsList">
                <div class="loading">Loading community reviews...</div>
            </div>
            <button class="btn btn-small" onclick="loadReviews()" style="margin-top: 20px;">Refresh Reviews</button>
        </div>
        
        <div id="guide-tab" class="content hidden">
            <h2>Scoring Guide</h2>
            
            <h3>üéØ Overall Score: 1-50 Scale</h3>
            <p>Final rating combines all categories below</p>
            
            <h3>üëÖ Taste (1-10)</h3>
            <ul>
                <li><strong>10:</strong> Surprisingly delicious, would actively seek out again</li>
                <li><strong>8:</strong> Very good, pleasant surprise</li>
                <li><strong>6:</strong> Decent, wouldn't avoid it</li>
                <li><strong>4:</strong> Edible but underwhelming</li>
                <li><strong>2:</strong> Unpleasant, hard to finish</li>
                <li><strong>1:</strong> Inedible, had to spit out</li>
            </ul>
            
            <h3>ü§ö Texture (1-10)</h3>
            <ul>
                <li><strong>10:</strong> Perfect/interesting texture that enhances the experience</li>
                <li><strong>8:</strong> Good mouthfeel, works well</li>
                <li><strong>6:</strong> Acceptable texture</li>
                <li><strong>4:</strong> Somewhat off-putting but manageable</li>
                <li><strong>2:</strong> Very strange/unpleasant texture</li>
                <li><strong>1:</strong> Revolting texture, ruins the food</li>
            </ul>
            
            <h3>üëÉ Aroma (1-10)</h3>
            <ul>
                <li><strong>10:</strong> Enticing smell that builds anticipation</li>
                <li><strong>8:</strong> Pleasant or neutral</li>
                <li><strong>6:</strong> Mild off-putting smell</li>
                <li><strong>4:</strong> Strong unpleasant odor but tolerable</li>
                <li><strong>2:</strong> Very bad smell, affects eating experience</li>
                <li><strong>1:</strong> Nauseating smell</li>
            </ul>
            
            <h3>üëÅÔ∏è Visual Appeal (1-10)</h3>
            <ul>
                <li><strong>10:</strong> Looks appetizing despite being unusual</li>
                <li><strong>8:</strong> Interesting/exotic looking in a good way</li>
                <li><strong>6:</strong> Strange but not off-putting</li>
                <li><strong>4:</strong> Somewhat unappealing visually</li>
                <li><strong>2:</strong> Looks quite unappetizing</li>
                <li><strong>1:</strong> Visually revolting</li>
            </ul>
            
            <h3>‚úÖ Would Recommend Factor (1-10)</h3>
            <ul>
                <li><strong>10:</strong> Absolutely, everyone should try this</li>
                <li><strong>8:</strong> Yes, to adventurous eaters</li>
                <li><strong>6:</strong> Maybe, depends on the person</li>
                <li><strong>4:</strong> Only to very adventurous types</li>
                <li><strong>2:</strong> No, unless they really want the experience</li>
                <li><strong>1:</strong> Would actively warn people away</li>
            </ul>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        let supabase = null;
        let isConnected = false;
        
        // Load saved connection settings
        window.addEventListener('load', function() {
            const savedUrl = localStorage.getItem('supabaseUrl');
            const savedKey = localStorage.getItem('supabaseKey');
            
            if (savedUrl && savedKey) {
                document.getElementById('supabaseUrl').value = savedUrl;
                document.getElementById('supabaseKey').value = savedKey;
                connectSupabase();
            }
            
            initializeSliders();
        });
        
        function connectSupabase() {
            const url = document.getElementById('supabaseUrl').value.trim();
            const key = document.getElementById('supabaseKey').value.trim();
            
            if (!url || !key) {
                showError('setup-error', 'Please enter both URL and key');
                return;
            }
            
            try {
                supabase = window.supabase.createClient(url, key);
                
                // Test connection
                testConnection().then(success => {
                    if (success) {
                        isConnected = true;
                        localStorage.setItem('supabaseUrl', url);
                        localStorage.setItem('supabaseKey', key);
                        
                        document.getElementById('connection-status').className = 'status-indicator status-connected';
                        document.getElementById('connection-text').textContent = 'Connected';
                        document.getElementById('setupTableBtn').disabled = false;
                        
                        showSuccess('setup-success', 'Connected to Supabase successfully!');
                        hideError('setup-error');
                        
                        // Update review form
                        updateReviewForm();
                    } else {
                        throw new Error('Connection test failed');
                    }
                });
                
            } catch (error) {
                showError('setup-error', 'Invalid credentials or connection failed');
                isConnected = false;
            }
        }
        
        async function testConnection() {
            try {
                const { data, error } = await supabase.from('reviews').select('*').limit(1);
                return !error || error.code === 'PGRST116'; // Table might not exist yet, that's ok
            } catch (error) {
                return false;
            }
        }
        
        async function setupTable() {
            if (!supabase) {
                showError('setup-error', 'Not connected to Supabase');
                return;
            }
            
            try {
                // Try to create the table using RPC or direct SQL
                const { data, error } = await supabase.rpc('exec_sql', {
                    sql: `
                        CREATE TABLE IF NOT EXISTS reviews (
                            id BIGSERIAL PRIMARY KEY,
                            food_name TEXT NOT NULL,
                            taste INTEGER NOT NULL CHECK (taste >= 1 AND taste <= 10),
                            texture INTEGER NOT NULL CHECK (texture >= 1 AND texture <= 10),
                            aroma INTEGER NOT NULL CHECK (aroma >= 1 AND aroma <= 10),
                            visual INTEGER NOT NULL CHECK (visual >= 1 AND visual <= 10),
                            recommend INTEGER NOT NULL CHECK (recommend >= 1 AND recommend <= 10),
                            total_score INTEGER NOT NULL,
                            summary TEXT,
                            reviewer_name TEXT DEFAULT 'Anonymous',
                            created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
                        );
                        
                        ALTER TABLE reviews ENABLE ROW LEVEL SECURITY;
                        
                        DO $$
                        BEGIN
                            IF NOT EXISTS (SELECT 1 FROM pg_policies WHERE tablename = 'reviews' AND policyname = 'Allow all operations') THEN
                                CREATE POLICY "Allow all operations" ON reviews FOR ALL USING (true);
                            END IF;
                        END $$;
                    `
                });
                
                if (error) {
                    throw error;
                }
                
                showSuccess('setup-success', 'Table created successfully! You can now save reviews.');
                
            } catch (error) {
                showError('setup-error', 'Table creation failed. Please run the SQL manually in Supabase SQL editor.');
            }
        }
        
        function updateReviewForm() {
            const formContainer = document.getElementById('review-form-container');
            const notConnectedMsg = document.getElementById('review-not-connected');
            
            if (isConnected) {
                formContainer.classList.remove('hidden');
                notConnectedMsg.classList.add('hidden');
            } else {
                formContainer.classList.add('hidden');
                notConnectedMsg.classList.remove('hidden');
            }
        }
        
        function showError(elementId, message) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.classList.remove('hidden');
        }
        
        function hideError(elementId) {
            document.getElementById(elementId).classList.add('hidden');
        }
        
        function showSuccess(elementId, message) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.classList.remove('hidden');
        }
        
        // Initialize sliders and their displays
        const sliders = ['taste', 'texture', 'aroma', 'visual', 'recommend'];
        
        function initializeSliders() {
            sliders.forEach(slider => {
                const element = document.getElementById(slider);
                const display = document.getElementById(slider + '-display');
                
                element.addEventListener('input', function() {
                    const value = parseInt(this.value);
                    const description = getScoreDescription(slider, value);
                    display.innerHTML = `<strong>${value}/10</strong><br><small style="color: #666; font-size: 0.9rem;">${description}</small>`;
                    updateFinalScore();
                });
                
                // Initialize display
                const value = parseInt(element.value);
                const description = getScoreDescription(slider, value);
                display.innerHTML = `<strong>${value}/10</strong><br><small style="color: #666; font-size: 0.9rem;">${description}</small>`;
            });
            
            updateFinalScore();
        }
        
        function getScoreDescription(category, score) {
            const descriptions = {
                taste: {
                    10: "Surprisingly delicious, would actively seek out again",
                    9: "Surprisingly delicious, would actively seek out again",
                    8: "Very good, pleasant surprise",
                    7: "Very good, pleasant surprise",
                    6: "Decent, wouldn't avoid it",
                    5: "Decent, wouldn't avoid it",
                    4: "Edible but underwhelming",
                    3: "Edible but underwhelming",
                    2: "Unpleasant, hard to finish",
                    1: "Inedible, had to spit out"
                },
                texture: {
                    10: "Perfect/interesting texture that enhances the experience",
                    9: "Perfect/interesting texture that enhances the experience",
                    8: "Good mouthfeel, works well",
                    7: "Good mouthfeel, works well",
                    6: "Acceptable texture",
                    5: "Acceptable texture",
                    4: "Somewhat off-putting but manageable",
                    3: "Somewhat off-putting but manageable",
                    2: "Very strange/unpleasant texture",
                    1: "Revolting texture, ruins the food"
                },
                aroma: {
                    10: "Enticing smell that builds anticipation",
                    9: "Enticing smell that builds anticipation",
                    8: "Pleasant or neutral",
                    7: "Pleasant or neutral",
                    6: "Mild off-putting smell",
                    5: "Mild off-putting smell",
                    4: "Strong unpleasant odor but tolerable",
                    3: "Strong unpleasant odor but tolerable",
                    2: "Very bad smell, affects eating experience",
                    1: "Nauseating smell"
                },
                visual: {
                    10: "Looks appetizing despite being unusual",
                    9: "Looks appetizing despite being unusual",
                    8: "Interesting/exotic looking in a good way",
                    7: "Interesting/exotic looking in a good way",
                    6: "Strange but not off-putting",
                    5: "Strange but not off-putting",
                    4: "Somewhat unappealing visually",
                    3: "Somewhat unappealing visually",
                    2: "Looks quite unappetizing",
                    1: "Visually revolting"
                },
                recommend: {
                    10: "Absolutely, everyone should try this",
                    9: "Absolutely, everyone should try this",
                    8: "Yes, to adventurous eaters",
                    7: "Yes, to adventurous eaters",
                    6: "Maybe, depends on the person",
                    5: "Maybe, depends on the person",
                    4: "Only to very adventurous types",
                    3: "Only to very adventurous types",
                    2: "No, unless they really want the experience",
                    1: "Would actively warn people away"
                }
            };
            
            return descriptions[category][score] || "";
        }

        function updateFinalScore() {
            let total = 0;
            sliders.forEach(slider => {
                const value = parseInt(document.getElementById(slider).value);
                total += value;
            });
            
            document.getElementById('finalScore').textContent = total + '/50';
            
            // Update score category
            const category = document.getElementById('scoreCategory');
            if (total >= 40) {
                category.textContent = "Outstanding weird food experience!";
            } else if (total >= 30) {
                category.textContent = "Good weird food experience";
            } else if (total >= 20) {
                category.textContent = "Challenging but edible unusual food experience";
            } else if (total >= 10) {
                category.textContent = "Difficult weird food experience";
            } else {
                category.textContent = "Avoid at all costs!";
            }
        }
        
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.content').forEach(tab => {
                tab.classList.add('hidden');
            });
            
            // Remove active class from all tab buttons
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName + '-tab').classList.remove('hidden');
            
            // Add active class to clicked tab
            event.target.classList.add('active');
            
            // Load reviews if history tab is selected
            if (tabName === 'history') {
                loadReviews();
            }
            
            // Update review form visibility
            if (tabName === 'review') {
                updateReviewForm();
            }
        }
        
        document.getElementById('reviewForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (!supabase || !isConnected) {
                alert('Please connect to Supabase first in the Setup tab.');
                return;
            }
            
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Saving...';
            
            try {
                const review = {
                    food_name: document.getElementById('foodName').value,
                    reviewer_name: document.getElementById('reviewerName').value || 'Anonymous',
                    taste: parseInt(document.getElementById('taste').value),
                    texture: parseInt(document.getElementById('texture').value),
                    aroma: parseInt(document.getElementById('aroma').value),
                    visual: parseInt(document.getElementById('visual').value),
                    recommend: parseInt(document.getElementById('recommend').value),
                    summary: document.getElementById('summary').value
                };
                
                review.total_score = review.taste + review.texture + review.aroma + review.visual + review.recommend;
                
                const { data, error } = await supabase
                    .from('reviews')
                    .insert([review]);
                
                if (error) {
                    throw error;
                }
                
                // Reset form
                this.reset();
                document.getElementById('reviewerName').value = 'Anonymous';
                sliders.forEach(slider => {
                    document.getElementById(slider).value = 5;
                    const description = getScoreDescription(slider, 5);
                    document.getElementById(slider + '-display').innerHTML = `<strong>5/10</strong><br><small style="color: #666; font-size: 0.9rem;">${description}</small>`;
                });
                updateFinalScore();
                
                alert('Review saved successfully and shared with the community!');
                
            } catch (error) {
                console.error('Error saving review:', error);
                alert('Failed to save review. Please try again.');
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Share Review with Community';
            }
        });
        
        async function loadReviews() {
            if (!supabase || !isConnected) {
                document.getElementById('reviewsList').innerHTML = '<div class="error">Please connect to Supabase first in the Setup tab.</div>';
                return;
            }
            
            document.getElementById('reviewsList').innerHTML = '<div class="loading">Loading community reviews...</div>';
            
            try {
                const { data: reviews, error } = await supabase
                    .from('reviews')
                    .select('*')
                    .order('created_at', { ascending: false })
                    .limit(50);
                
                if (error) {
                    throw error;
                }
                
                const container = document.getElementById('reviewsList');
                
                if (reviews.length === 0) {
                    container.innerHTML = '<div class="empty-state">No reviews yet! Be the first to review a weird food!</div>';
                    return;
                }
                
                container.innerHTML = reviews.map(review => `
                    <div class="review-card">
                        <div class="review-header">
                            <div class="food-name">${review.food_name}</div>
                            <div class="review-score">${review.total_score}/50</div>
                        </div>
                        
                        <div class="review-details">
                            <div class="detail-item">
                                <div class="detail-label">Taste</div>
                                <div class="detail-score">${review.taste}/10</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Texture</div>
                                <div class="detail-score">${review.texture}/10</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Aroma</div>
                                <div class="detail-score">${review.aroma}/10</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Visual</div>
                                <div class="detail-score">${review.visual}/10</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Recommend</div>
                                <div class="detail-score">${review.recommend}/10</div>
                            </div>
                        </div>
                        
                        ${review.summary ? `<div class="review-summary">"${review.summary}"</div>` : ''}
                        
                        <div class="review-meta">
                            Reviewed by <strong>${review.reviewer_name}</strong> on ${new Date(review.created_at).toLocaleDateString()}
                        </div>
                    </div>
                `).join('');
                
            } catch (error) {
                console.error('Error loading reviews:', error);
                document.getElementById('reviewsList').innerHTML = '<div class="error">Failed to load reviews. Please try again.</div>';
            }
        }
    </script>
</body>
</html>